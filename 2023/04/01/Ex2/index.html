<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css">
<!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>一带一路暨金砖国家技能赛 - 云计算赛项样题 | HugeH4rD</title><meta name="keywords" content="ChinaSkills,云计算,金砖,样题,职业技能大赛"><meta name="author" content="Zelas2Xerath"><meta name="copyright" content="Zelas2Xerath"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="一带一路暨金砖国家技能赛 - 云计算赛项样题"><meta name="application-name" content="一带一路暨金砖国家技能赛 - 云计算赛项样题"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="一带一路暨金砖国家技能赛 - 云计算赛项样题"><meta property="og:url" content="https://blog.806006.xyz/2023/04/01/Ex2/index.html"><meta property="og:site_name" content="HugeH4rD"><meta property="og:description" content="一带一路暨金砖国家技能赛 - 云计算赛项样题解析"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg"><meta property="article:author" content="Zelas2Xerath"><meta property="article:tag" content="HugeHard"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg"><meta name="description" content="一带一路暨金砖国家技能赛 - 云计算赛项样题解析"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.806006.xyz/2023/04/01/Ex2/"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?https://hm.baidu.com/hm.js?507aaada61753bb4ef1c80e5ec474730";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"HUGEH4rD","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":null,"Referer":null},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://c.806006.xyz/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: {"apiurl":"http://f.806006.xyz:65200/"},
  navMusic: true,
  mainTone: {"mode":"api","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: undefined,
  algolia: {"appId":"CSB4N1T1KG","apiKey":"1464ef4919d9840097b34ad63316b351","indexName":"hexo","hits":{"per_page":6},"languages":{"input_placeholder":"输入关键词后按下回车查找","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"这篇文章已经有","messageNext":"天没有更新了, 其中的某些内容可能已经过期."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":666,"languages":{"author":"作者: Zelas2Xerath","link":"链接: ","source":"来源: HugeH4rD","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'HugeH4rD',
  title: '一带一路暨金砖国家技能赛 - 云计算赛项样题',
  postAI: '',
  pageFillDescription: '一带一路暨金砖国家技能赛 - 云计算赛项样题, A模块题目：OpenStack 平台部署与运维, 任务1 私有云平台环境初始化（ 6 分）, 1.配置主机名, 2.配置 hosts 文件, 3.挂载光盘镜像, 4.配置 controller 节点 yum 源, 5.搭建 ftp 服务器, 6.配置 compute 节点 yum 源, 7.分区, 8.系统调优 脏数据回写, 任务 2 OpenStack 搭建任务 8 分, 1.修改脚本文件, 2.修改脚本文件, 3.安装openstack包, 4.搭建数据库组件, 5.搭建认证服务组件, 6.搭建镜像服务组件, 7.搭建计算服务组件, 8.搭建网络组件并初始化网络, 9.搭建形化界面, 任务 3 OpenStack 运维任务（ 13 分）, 1.安全组管理, 2.项目管理, 3.用户管理, 4.镜像管理, 5.后端配置文件管理, 6.存储服务管理, 7.数据库管理, 8.数据库管理, 9.存储管理, 10.存储管理, 11.存储管理, 12.存储管理, 13.添加控制节点资源到云平台, 任务四 OpenStack 架构 任务 3 分, 1.创建浮动IP, 2.删除浮动IP, B模块题目：容器的编排与运维, 任务 1 容器云平台环境初始化（ 10 分）, 1.容器云平台的初始化, 2.Yum 源数据的持久化挂载, 3.Yum 源的编写, 4.Yum 源的编写, 5.Yum 源的编写, 6.设时间同步服务器, 7.设置免密登录, 任务 2 k8s 搭建任务 15 分, 1.安装 docker 应用, 2.安装 docker 应用, 3.安装 docker compose, 4.搭建 horbor 仓库, 5.上传 docker 镜像, 6.安装 kubeadm 工具, 7.初始化 master 节点, 8.删除污点, 9.安装 kubernetes 网络插件, 10.给 kubernetes 创建证书, 11.kubernetes 图形化界面的安装, 12.扩展计算节点, 任务 3 EFK 日志平台构建 15 分, 1.导入镜像, 2.NFS 配置, 3.RBAC 配置, 4.RBAC 配置, 5.StorageClass动态绑定, 6.StorageClass动态绑定, 7.通过 statefulset 创建 elasticsearch 集群, 8.创建 headless service, 9.Kibana 可视化 UI 界面部署, 10.Fluentd 组件部署, C模块题目：企业级应用的自动化部署和运维, 任务1 企业级应用的自动化部署（ 10 分）, 1.部署主从数据库, 2.部署 zookeeper 集群, 任务 2 应用商城系统部署 【 10 分】, 1.gpmall 部署, 任务 3 Prometheus 监控 Mariadb 主从数据库【 10 分】, 1.Prometheus 及 Grafana 搭建, 2.Prometheus 配置自定义监控项、 mysqld_exporter 安装及配置一带一路暨金砖国家技能赛云计算赛项样题校验勘误模块题目平台部署与运维业务场景某企业拟使用搭建一个企业云平台用于部署各类企业应用对外对内服务云平台可实现资源池化弹性分配集中管理性能优化以及统一安全认证等系统结构如下图企业云平台的搭建使用竞赛平台提供的两台云服务器配置如下表设备主机名接口地址云服务器云服务器任务私有云平台环境初始化分配置主机名把节点主机名设置为节点主机名设置为分别在节点和节点将命令的返回结果提交到答题框分配置文件分别在节点和节点修改文件将地址映射为主机名请在节点将命令的返回结果提交到答题框分挂载光盘镜像将提供的和光盘镜像移动到节点目录下然后在目录下使用命令创建目录和目录并将镜像文件挂载到目录下将镜像文件挂载到目录下请在节点将命令的返回结果提交到答题框分配置节点源将节点原有的源移动到目录为节点创建本地源源文件名为请将的返回结果提交到答题框分搭建服务器在节点上安装服务将目录设为共享并设置为开机自启动然后重启服务生效请将命令的返回结果提交到答题框分配置节点源将节点原有的源移动到目录为节点创建源源文件名为其中服务器为节点配置源时不要写地址请将命令的返回结果提交到答题框分分区在节点将分为两个区分别为和大小自定义要求分区格式为使用命令对文件系统格式化请将命令的返回结果提交到答题框分系统调优脏数据回写系统内存中会存在脏数据一般系统默认脏数据占用内存时会回写磁盘修改系统配置文件要求将回写磁盘的大小调整为在节点请将命令的返回结果提交到答题框分任务搭建任务分修改脚本文件在节点和节点分别安装软件包修改脚本文件基本变量脚本文件为修改完成后使用命令生效该脚本文件在节点请将命令的返回结果提交到答题框分修改脚本文件在节点配置文件根据环境情况修改参数块存储服务的后端使用第二块硬盘的第一个分区生效该参数文件请将命令的返回结果提交到答题框分安装包分别在节点和节点执行文件不需要重启云主机在节点请将命令的返回结果提交到答题框分搭建数据库组件在节点执行脚本会自行安装等服务和完成相关配置执行完成后修改配置文件将缓存修改为并重启相应服务请将命令的返回结果提交到答题框分搭建认证服务组件在节点执行脚本会自行安装服务和完成相关配置使用命令创建一个名为的账户密码为邮箱为请将命令的返回结果提交到答题框分搭建镜像服务组件在节点执行脚本会自行安装服务和完成相关配置完成后使用命令创建一个名为的镜像镜像文件使用请将命令的返回结果提交到答题框分搭建计算服务组件在节点执行节点执行会自行安装服务和完成相关配置使用命令创建一个名为为内存为磁盘容量为数量为的云主机类型在节点请将命令的返回结果提交到答题框分搭建网络组件并初始化网络在节点执行节点执行会自行安装服务并完成配置创建云主机外部网络子网为云主机浮动可用网段为网关为在节点请将命令的返回结果提交到答题框分搭建形化界面在节点执行脚本会自行安装服务并完成配置请修改配置文件使之能通过公网访问首页在节点请将命令的返回结果提交到答题框分任务运维任务分某公司构建了一套内部私有云系统这套私有云系统将为公司内部提供计算服务你将作为该私有云的维护人员请完成以下运维工作安全组管理使用命令创建名称为的安全组该安全组的描述为用命令为安全组添加规则和规则允许任意地址访问完成后查看该安全组的详细信息将命令的返回结果提交到答题框分项目管理在中创建项目添加描述为完成后使用命令禁用该项目请将命令的返回结果提交到答题框分用户管理使用命令查看租户的当前配额值将租户的实例配额提升到请将命令的返回结果提交到答题框分镜像管理登录节点使用相关命令上传镜像源使用名字为修改这个镜像为共享状态并设置最小磁盘为请将命令的返回结果提交到答题框分后端配置文件管理请修改后端配置文件将项目的映像存储限制为完成后重启服务请将命令的返回结果提交到答题框分存储服务管理在节点执行节点执行在和节点上会自行安装服务并完成配置创建一个名为的卷类型创建该类型规格键值对要求卷类型对应后端驱动所管理的存储资源名字大小的云硬盘并查询该云硬盘的详细信息请将命令的返回结果提交到答题框分数据库管理请使用数据库命令将所有数据库进行备份备份文件名为完成后使用命令查看文件属性其中文件大小以显示请将命令的返回结果提交到答题框分数据库管理进入数据库创建本地用户密码为然后查询数据库中的表的字段然后赋予这个用户所有数据库的查询删除更新创建的权限请将命令的返回结果提交到答题框分存储管理请使用命令创建一个名为的卷卷大小为完成后使用命令列出卷列表并查看卷的详细信息请将命令的返回结果提交到答题框分存储管理为了减缓来自实例的数据访问速度的变慢支持对卷数据复制带宽的速率限制请修改后端配置文件将卷复制带宽限制为最高请将命令的返回结果提交到答题框分存储管理在节点执行节点执行在和节点上会自行安装服务并完成配置创建一个名为的容器请将命令的返回结果提交到答题框分存储管理用命令把上传到容器中请将命令的返回结果提交到答题框分添加控制节点资源到云平台修改中的内容然后在节点执行把节点的资源添加到云平台请将命令的返回结果提交到答题框分任务四架构任务分公司内部拥有一套私有云系统为了调试该私有云需要编写一些测试用脚本进行功能性测试作为公司私有云维护人员请你完成以下工作创建浮动请使用命令创建一个浮动地址完成后使用命令查看该浮动的请编写一个名为的脚本该脚本变量为浮动的对接服务端点获取该浮动的详细信息脚本使用向端点传递参数为了兼容性考虑不得出现命令请将中部分替换为正常内容并提交到答题框分获取将应用到环境变量获取该浮动的删除浮动请编写脚本完成浮动的删除设置一个变量当用户向传递一个浮动的即可完成该浮动的删除脚本使用向端点传递参数为了兼容性考虑不得出现命令请将中部分替换为正常内容并提交到答题框分模块题目容器的编排与运维某企业计划使用平台搭建微服务系统现在先使用简单的微服务项目进行测试请按照要求完成相应任务设备名称主机名接口地址云服务器私网云服务器私网云服务器私网云服务器私网任务容器云平台环境初始化分容器云平台的初始化节点主机名设置为节点主机名设置为节点主机名设置为节点主机名设置为所有节点关闭并配置映射请在节点将命令的返回结果提交到答题框分源数据的持久化挂载将提供的和光盘镜像文件移动到节点目录下然后在目录下使用命令创建目录和目录并将镜像文件永久挂载到目录下将镜像文件永久挂载到目录下请在节点将命令的返回结果提交到答题框分源的编写在节点首先将系统自带的源移动到目录然后为节点配置本地源源文件名为请将命令的返回结果提交到答题框分源的编写在节点安装服务将共享目录设置为请将命令的返回结果提交到答题框分源的编写为节点和节点分别配置源源文件名称为其中服务器地址为节点配置源时不要写地址配置之后两台机器都安装包作为安装测试在节点请将命令的返回结果提交到答题框分设时间同步服务器在节点上部署服务器允许其它节点同步时间启动服务并设置为开机自启动在其他节点上指定节点为上游服务器重启服务并设为开机自启动在节点将命令的返回结果提交到答题框分设置免密登录为四台服务器设置免密登录保证服务器之间能够互相免密登录在节点将命令的返回结果提交到答题框分任务搭建任务分安装应用在所有节点上安装并设置为开机自启动在节点请将命令的返回结果提交到答题框分安装应用所有节点配置阿里云镜像加速地址并把启动引擎设置为配置成功重启服务请将文件中的内容提交到答题框分安装在节点创建目录并把挂载到目录下使用文件安装安装完成后执行命令请将命令返回结果提交到答题框分搭建仓库在节点使用离线安装包安装仓库并修改各节点默认仓库为仓库地址在节点请将命令的返回结果提交到答题框分修改第行域名注释及证书部分修改密码上传镜像在节点使用命令将目录下所有镜像导入本地然后使用将所有镜像上传至仓库在节点请将命令的返回结果提交到答题框分安装工具在节点节点节点分别安装工具并设置为开机自启动在节点请将命令的返回结果提交到答题框分初始化节点使用命令生成文件并修改文件设置虚拟内部网段地址为通过该文件初始化节点然后使用完成控制节点初始化设置在节点的执行前将命令的返回结果提交到答题框分删除污点使用命令删除节点的污点使得也可以调度到节点上在节点请将命令的返回结果提交到答题框分安装网络插件使用安装网络插件安装完成后使用命令查看节点状态在节点请将命令的返回结果提交到答题框分给创建证书在节点请将命令的返回结果提交到答题框分图形化界面的安装使用和安装界面完成后查看首页请将命令的返回结果提交到答题框分获取在中登录扩展计算节点在节点和节点分别使用命令生成文件并通过文件将节点加入集群完成后在节点上查看所有节点状态在节点请将命令的返回结果提交到答题框分上方已包含了该操作任务日志平台构建分导入镜像将提供的压缩包中的镜像导入到节点并使用命令将镜像上传至镜像仓库中在节点将命令的返回结果提交到答题框分配置在节点节点节点分别安装服务节点作为服务端把目录作为共享目录只允许网段访问在节点将命令的返回结果提交到答题框分配置在节点编写创建名称为的账号将命令的返回结果提交到答题框分配置编写对创建的账号进行授权基于文件创建完成后使用命令分别查看账号和授权信息将命令的返回结果提交到答题框分动态绑定编写文件基于镜像创建的对象绑定服务端的共享目录将命令的返回结果提交到答题框分动态绑定编写文件创建动态绑定完成后查看的及对象将命令的返回结果提交到答题框分通过创建集群编写通过文件构建的集群集群中有个副本名字分别为并且使用上述提供的存储使用镜像并且声明端口为端口端口为内部访问端口并且添加的初始化容器对的数据目录进行授权操作将命令的返回结果提交到答题框分创建编写文件为的创建一个并在中声明和端口将命令的返回结果提交到答题框分可视化界面部署编写通过该文件创建和其中基于镜像创建并通过环境变量指定服务地址代理的服务并且使用类型创建成功后在浏览器访问的界面将命令的返回结果提交到答题框分组件部署编写通过文件创建控制器部署服务并在该文件中同时编写相关的账号和内容创建成功后保证可以正确采集容器内的日志将命令的返回结果提交到答题框分模块题目企业级应用的自动化部署和运维虚拟机与环境规划设备名称主机名接口地址云服务器私网云服务器私网云服务器私网任务企业级应用的自动化部署分部署主从数据库修改主机名节点主机名为节点主机名为节点主机名为请使用提供的软件包在节点安装将命令的返回结果提交到答题框分配置主机清单文件创建主机组主机组内添加和主机创建主机组组内添加主机创建主机组组内添加主机并配置免密登录将命令的返回结果提交到答题框分主机组内所有主机安装数据库启动数据库并设置为开机自启动在节点将命令的返回结果提交到答题框分编写一名称为的脚本该脚本具有完成数据库的初始化功能要求数据库用户名为密码为通过对应模块执行完成对主机组下的所有节点进行数据库初始化在节点将命令的返回结果提交到答题框分创建主机变量所有主机组中节点创建变量节点创建变量将命令的返回结果提交到答题框分根据配置文件创建的模板文件命名为编写文件实现主从数据库的配置和权限设置在节点通过命令查看文件内容返回结果提交到答题框在节点进入数据库将命令的返回结果提交到答题框分和的状态都为则从节点服务开启成功部署集群是一个分布式服务框架是的一个子项目主要是用来解决分布式应用中经常遇到的一些数据管理问题如统一命名服务状态同步服务集群管理分布式应用配置项的管理等商城系统中用到了消息队列集群的搭建依赖集群来进行元数据的管理编写主机清单文件创建主机组主机组内添加和主机分别创建主机变量将命令的返回结果提交到答题框分在节点使用提供的软件包编写文件实现集群搭建创建任务清单实现安装包批量解压通过模板文件配置创建的文件和批量启动功能在三个节点相应的目录使用命令查看三个节点的状态在主机上将命令结果提交到答题框将命令的返回结果提交到答题框分任务应用商城系统部署分部署在节点使用提供的软件包完成集群应用系统部署部署完成后进行登录最后使用命令去获取商城首页的返回信息先将命令的返回结果提交到答题框然后将命令的返回结果提交到答题框分在配置文件的最后部分修改数据库为然后删除如下几行将修改为修改为最后部分将改成查看四个后端服务是否成功启动任务监控主从数据库分及搭建根据资源包安装服务并启动安装服务并测试浏览器登陆先将文件中的内容提交到答题框然后将命令的返回结果提交到答题框分配置自定义监控项安装及配置根据安装并创建文件添加被监控数据库用户名密码修改文件添加两个任务抓取间隔都设置分别监控主从节点的端口重启并刷新页面将和中的内容提交到答题框分',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-01 22:00:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.png"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.806006.xyz/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://blog.806006.xyz/img/favicon.png" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://pan.806006.xyz/" title="云盘主线"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://blog.806006.xyz/img/favicon.png" alt="云盘主线"/><span class="back-menu-item-text">云盘主线</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://yun.806006.xyz/" title="云盘备线"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://blog.806006.xyz/img/favicon.png" alt="云盘备线"/><span class="back-menu-item-text">云盘备线</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://axerath.gitee.io/" title="Gitee Page"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://blog.806006.xyz/img/favicon.png" alt="Gitee Page"/><span class="back-menu-item-text">Gitee Page</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://zelas2xerath.github.io/" title="Github Page"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://blog.806006.xyz/img/favicon.png" alt="Github Page"/><span class="back-menu-item-text">Github Page</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">HugeH4rD</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 板块</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/Openwrt/"><i class="fa-solid fa-wifi faa-tada"></i><span> OpenWrt</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Pwn/"><i class="fa-solid fa-0 faa-tada"></i><span> Pwn</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Reverse/"><i class="fa-brands fa-500px faa-tada"></i><span> Reverse</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Net/"><i class="fa-brands fa-battle-net faa-tada"></i><span> Net</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 好物清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" alt="wechat" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.jpg"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" alt="alipay" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.jpg"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NET/" style="font-size: 1.05rem;">.NET<sup>1</sup></a><a href="/tags/AMD/" style="font-size: 1.05rem;">AMD<sup>1</sup></a><a href="/tags/AWX/" style="font-size: 1.05rem;">AWX<sup>1</sup></a><a href="/tags/ChinaSkills/" style="font-size: 1.05rem;">ChinaSkills<sup>2</sup></a><a href="/tags/DIY/" style="font-size: 1.05rem;">DIY<sup>1</sup></a><a href="/tags/DirectX/" style="font-size: 1.05rem;">DirectX<sup>1</sup></a><a href="/tags/GPU/" style="font-size: 1.05rem;">GPU<sup>1</sup></a><a href="/tags/IDA/" style="font-size: 1.05rem;">IDA<sup>1</sup></a><a href="/tags/KVM/" style="font-size: 1.05rem;">KVM<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 1.05rem;">Markdown<sup>1</sup></a><a href="/tags/Office/" style="font-size: 1.05rem;">Office<sup>1</sup></a><a href="/tags/Openwrt/" style="font-size: 1.05rem;">Openwrt<sup>8</sup></a><a href="/tags/Potplayer/" style="font-size: 1.05rem;">Potplayer<sup>1</sup></a><a href="/tags/Pwn/" style="font-size: 1.05rem;">Pwn<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>1</sup></a><a href="/tags/RHCE/" style="font-size: 1.05rem;">RHCE<sup>1</sup></a><a href="/tags/RHCSA/" style="font-size: 1.05rem;">RHCSA<sup>1</sup></a><a href="/tags/Redhat/" style="font-size: 1.05rem;">Redhat<sup>2</sup></a><a href="/tags/Runtimes/" style="font-size: 1.05rem;">Runtimes<sup>4</sup></a><a href="/tags/Ryzen/" style="font-size: 1.05rem;">Ryzen<sup>1</sup></a><a href="/tags/Windows/" style="font-size: 1.05rem;">Windows<sup>12</sup></a><a href="/tags/ansible/" style="font-size: 1.05rem;">ansible<sup>1</sup></a><a href="/tags/cpu/" style="font-size: 1.05rem;">cpu<sup>3</sup></a><a href="/tags/eNSP/" style="font-size: 1.05rem;">eNSP<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 1.05rem;">hexo<sup>2</sup></a><a href="/tags/idm/" style="font-size: 1.05rem;">idm<sup>1</sup></a><a href="/tags/iperf/" style="font-size: 1.05rem;">iperf<sup>1</sup></a><a href="/tags/pip/" style="font-size: 1.05rem;">pip<sup>1</sup></a><a href="/tags/pwn/" style="font-size: 1.05rem;">pwn<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">云计算<sup>2</sup></a><a href="/tags/%E6%98%BE%E7%A4%BA%E5%99%A8/" style="font-size: 1.05rem;">显示器<sup>1</sup></a><a href="/tags/%E6%A0%B7%E9%A2%98/" style="font-size: 1.05rem;">样题<sup>2</sup></a><a href="/tags/%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" style="font-size: 1.05rem;">职业技能大赛<sup>2</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 1.05rem;">虚拟化<sup>1</sup></a><a href="/tags/%E8%A3%85%E6%9C%BA/" style="font-size: 1.05rem; font-weight: 500; color: var(--anzhiyu-lighttext)">装机<sup>3</sup></a><a href="/tags/%E8%B6%85%E9%A2%91/" style="font-size: 1.05rem;">超频<sup>2</sup></a><a href="/tags/%E9%85%8D%E7%BD%AE%E5%8D%95/" style="font-size: 1.05rem;">配置单<sup>2</sup></a><a href="/tags/%E9%87%91%E7%A0%96/" style="font-size: 1.05rem;">金砖<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/01/"><span class="card-archive-list-date">一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url">运维</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/ChinaSkills/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>ChinaSkills</span></a><a class="article-meta__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>云计算</span></a><a class="article-meta__tags" href="/tags/%E9%87%91%E7%A0%96/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>金砖</span></a><a class="article-meta__tags" href="/tags/%E6%A0%B7%E9%A2%98/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>样题</span></a><a class="article-meta__tags" href="/tags/%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>职业技能大赛</span></a></span></div></div><h1 class="post-title" itemprop="name headline">一带一路暨金砖国家技能赛 - 云计算赛项样题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-04-01T14:00:00.000Z" title="发表于 2023-04-01 22:00:00">2023-04-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-04-01T14:00:00.000Z" title="更新于 2023-04-01 22:00:00">2023-04-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>57分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="一带一路暨金砖国家技能赛 - 云计算赛项样题"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.806006.xyz/2023/04/01/Ex2/"><header><a class="post-meta-categories" href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="url">运维</a><a href="/tags/ChinaSkills/" tabindex="-1" itemprop="url">ChinaSkills</a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" tabindex="-1" itemprop="url">云计算</a><a href="/tags/%E9%87%91%E7%A0%96/" tabindex="-1" itemprop="url">金砖</a><a href="/tags/%E6%A0%B7%E9%A2%98/" tabindex="-1" itemprop="url">样题</a><a href="/tags/%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" tabindex="-1" itemprop="url">职业技能大赛</a><h1 id="CrawlerTitle" itemprop="name headline">一带一路暨金砖国家技能赛 - 云计算赛项样题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Zelas2Xerath</span><time itemprop="dateCreated datePublished" datetime="2023-04-01T14:00:00.000Z" title="发表于 2023-04-01 22:00:00">2023-04-01</time><time itemprop="dateCreated datePublished" datetime="2023-04-01T14:00:00.000Z" title="更新于 2023-04-01 22:00:00">2023-04-01</time></header><h1 id="一带一路暨金砖国家技能赛-云计算赛项样题"><a href="#一带一路暨金砖国家技能赛-云计算赛项样题" class="headerlink" title="一带一路暨金砖国家技能赛 - 云计算赛项样题"></a>一带一路暨金砖国家技能赛 - 云计算赛项样题</h1><hr>
<p><strong>校验：</strong><code>@zelas2xerath</code></p>
<p><strong>勘误：</strong><code>leancode@189.cn</code></p>
<h2 id="A模块题目：OpenStack-平台部署与运维"><a href="#A模块题目：OpenStack-平台部署与运维" class="headerlink" title="A模块题目：OpenStack 平台部署与运维"></a>A模块题目：OpenStack 平台部署与运维</h2><p><strong>业务场景：</strong></p>
<p>某企业拟使用OpenStack搭建一个企业云平台，用于部署各类企业应用对外对内服务。云平台可实现IT资源池化、弹性分配、集中管理、性能优化以及统一安全认证等。系统结构如下图：<br>企业云平台的搭建使用竞赛平台提供的两台云服务器，配置如下表：</p>
<table>
<thead>
<tr>
<th align="center">设备</th>
<th align="center">主机名</th>
<th align="center">接口</th>
<th align="center">IP地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">云服务器1</td>
<td align="center">controller</td>
<td align="center">eth0<br />eth1</td>
<td align="center">192.168.100.100&#x2F;24<br />192.168.200.100&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器2</td>
<td align="center">compute</td>
<td align="center">eth0<br />eth1</td>
<td align="center">192.168.100.200&#x2F;24<br />192.168.200.200&#x2F;24</td>
</tr>
</tbody></table>
<hr>
<h3 id="任务1-私有云平台环境初始化（-6-分）"><a href="#任务1-私有云平台环境初始化（-6-分）" class="headerlink" title="任务1 私有云平台环境初始化（ 6 分）"></a>任务1 私有云平台环境初始化（ 6 分）</h3><h4 id="1-配置主机名"><a href="#1-配置主机名" class="headerlink" title="1.配置主机名"></a>1.配置主机名</h4><p>把controller节点主机名设置为controller, compute节点主机名设置为compute。 分别在controller节点和compute节点将hostname命令的返回结果提交到答题框。【0.5分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname --static controller</span><br><span class="line">hostnamectl set-hostname --static compute</span><br></pre></td></tr></table></figure>

<h4 id="2-配置-hosts-文件"><a href="#2-配置-hosts-文件" class="headerlink" title="2.配置 hosts 文件"></a>2.配置 hosts 文件</h4><p>分别在 controller 节点和 compute 节点 修改 hosts 文件将 IP 地址映射为主机名。<br>请在controller节点将cat &#x2F;etc&#x2F;hosts命令的返回结果提交到答题框。 【0.5分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.100.100 controller</span></span><br><span class="line"><span class="string">192.168.100.200 compute</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h4 id="3-挂载光盘镜像"><a href="#3-挂载光盘镜像" class="headerlink" title="3.挂载光盘镜像"></a>3.挂载光盘镜像</h4><p>将提供的 CentOS 7 x86_64 DVD 1804.iso 和 bricsskills_cloud_iaas.iso 光盘镜像 移动到 controller 节点 &#x2F;root 目录下，然后在 &#x2F;opt 目录下使用命令创建 centos 目录和 iaas 目录，并将镜像文 件 c entOS 7 x86_64 DVD 1804.iso 挂载到 &#x2F;centos 目录下，将镜像文件bricsskills_cloud_iaas.iso 挂载到 iaas 目录下。<br>请在 controller 节点 将 ls &#x2F;opt&#x2F; 命令的返回结果提交到 答题框。【 0.5 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/iaas /opt/centos</span><br><span class="line">mount /dev/sr0 /opt/iaas/</span><br><span class="line">mount /dev/sr1 /opt/centos/</span><br></pre></td></tr></table></figure>

<h4 id="4-配置-controller-节点-yum-源"><a href="#4-配置-controller-节点-yum-源" class="headerlink" title="4.配置 controller 节点 yum 源"></a>4.配置 controller 节点 yum 源</h4><p>将 controller 节点原有的 yum 源移动到 &#x2F;home 目录， 为 controller 节点创建本地 yum 源，yum 源文件名为 local.repo 。<br>请将 yum list | grep vsftpd 的返回结果提交到答题框。【 0.5 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /home/</span><br><span class="line"><span class="built_in">touch</span>  /etc/yum.repo.d/local.repo</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/local.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[centos]</span></span><br><span class="line"><span class="string">name=centos</span></span><br><span class="line"><span class="string">baseurl=file:///opt/centos</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">[iaas]</span></span><br><span class="line"><span class="string">name=iaas</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">baseurl=file:///opt/iaas/iaas-repo</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br><span class="line">yum list |grep vsftpd</span><br></pre></td></tr></table></figure>

<h4 id="5-搭建-ftp-服务器"><a href="#5-搭建-ftp-服务器" class="headerlink" title="5.搭建 ftp 服务器"></a>5.搭建 ftp 服务器</h4><p>在controller 节点上安装 vsftp 服务 , 将 &#x2F;opt 目录设为共享，并 设置为开机自启动， 然后重启服务生效。</p>
<p>请将 cat &#x2F;etc&#x2F;vsftpd&#x2F;vsftpd.conf |grep &#x2F;opt 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vsftpd </span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/vsftpd/vsftpd.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">anon_root=/opt</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd --now</span><br></pre></td></tr></table></figure>

<h4 id="6-配置-compute-节点-yum-源"><a href="#6-配置-compute-节点-yum-源" class="headerlink" title="6.配置 compute 节点 yum 源"></a>6.配置 compute 节点 yum 源</h4><p>将compute节点原有的yum源移动到&#x2F;home目录，为compute节点创建ftp源，yum源文件名为ftp.repo，其中ftp服务器为controller节点,配置ftp源时不要写IP地址。</p>
<p>请将yum list | grep xiandian命令的返回结果提交到答题框【1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /home</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/ftp.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[centos]</span></span><br><span class="line"><span class="string">name=centos</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">baseurl=ftp://controller/centos</span></span><br><span class="line"><span class="string">[iaas]</span></span><br><span class="line"><span class="string">name=iaas</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">baseurl=ftp://controller/iaas/iaas-repo</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br></pre></td></tr></table></figure>

<h4 id="7-分区"><a href="#7-分区" class="headerlink" title="7.分区"></a>7.分区</h4><p>在compute节点将vdb分为两个区分别为vdb1和vdb2,大小自定义。要求分区格式为gpt,使用mkfs.xfs命令对文件系统格式化。<br>请将 lsblk -f命令的返回结果提交到答题框【1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/vdb</span><br><span class="line">mklabel gpt</span><br><span class="line">mkpart primary 0% 50%</span><br><span class="line">mkpart primary 50% 100%</span><br><span class="line"></span><br><span class="line">mkfs.xfs /dev/vdb1</span><br><span class="line">mkfs.xfs /dev/vdb2</span><br><span class="line">lsblk -f</span><br></pre></td></tr></table></figure>

<h4 id="8-系统调优-脏数据回写"><a href="#8-系统调优-脏数据回写" class="headerlink" title="8.系统调优 脏数据回写"></a>8.系统调优 脏数据回写</h4><p>Linux 系统内存中会存在脏数据，一般系统默认脏数据占用内存 30 时会回写磁盘，修改系统配置文件，要求将回写磁盘的 大小调整为 60 。在 controller 节点 请将 sysctl p 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;vm.dirty_ratio = 60&#x27;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="任务-2-OpenStack-搭建任务-8-分"><a href="#任务-2-OpenStack-搭建任务-8-分" class="headerlink" title="任务 2 OpenStack 搭建任务 8 分"></a>任务 2 OpenStack 搭建任务 8 分</h3><h4 id="1-修改脚本文件"><a href="#1-修改脚本文件" class="headerlink" title="1.修改脚本文件"></a>1.修改脚本文件</h4><p>在 controller 节点和 compute 节点分别安装 iaas-xiandian 软件包，修改脚本文件基本变量（脚本文件为 &#x2F;etc&#x2F;xiandian&#x2F;openrc.sh 修改完成后使用命令生效该 脚本文件。</p>
<p>在 controller 节点 请将 <code>echo $INTERFACE_NAME</code> 命令的返回结果提交到答题框。【 0.5 分】</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">HOST_IP</span>=<span class="number">192.168</span>.<span class="number">100.100</span></span><br><span class="line"><span class="attr">HOST_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">HOST_NAME</span>=controller</span><br><span class="line"><span class="attr">HOST_IP_NODE</span>=<span class="number">192.168</span>.<span class="number">100.200</span></span><br><span class="line"><span class="attr">HOST_PASS_NODE</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">HOST_NAME_NODE</span>=compute</span><br><span class="line"><span class="attr">network_segment_IP</span>=<span class="number">192.168</span>.<span class="number">100.0</span>/<span class="number">24</span></span><br><span class="line"><span class="attr">RABBIT_USER</span>=openstack</span><br><span class="line"><span class="attr">RABBIT_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">DB_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">DOMAIN_NAME</span>=demo</span><br><span class="line"><span class="attr">ADMIN_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">DEMO_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">KEYSTONE_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">GLANCE_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">GLANCE_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">NOVA_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">NOVA_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">NEUTRON_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">NEUTRON_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">METADATA_SECRET</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">INTERFACE_IP</span>=<span class="number">192.168</span>.<span class="number">200.100</span></span><br><span class="line"><span class="attr">INTERFACE_NAME</span>=ens33</span><br><span class="line"><span class="attr">Physical_NAME</span>=provider</span><br><span class="line"><span class="attr">minvlan</span>=<span class="number">101</span></span><br><span class="line"><span class="attr">maxvlan</span>=<span class="number">200</span></span><br><span class="line"><span class="attr">CINDER_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">CINDER_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">BLOCK_DISK</span>=vdb1</span><br><span class="line"><span class="attr">SWIFT_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">OBJECT_DISK</span>=vdb2</span><br><span class="line"><span class="attr">STORAGE_LOCAL_NET_IP</span>=<span class="number">192.168</span>.<span class="number">100.200</span></span><br><span class="line"><span class="attr">HEAT_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">ZUN_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">ZUN_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">KURYR_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">KURYR_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">CEILOMETER_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">CEILOMETER_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">AODH_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">AODH_PASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">BARBICAN_DBPASS</span>=<span class="number">000000</span></span><br><span class="line"><span class="attr">BARBICAN_PASS</span>=<span class="number">000000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/xiandian/openrc.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$INTERFACE_NAME</span></span><br><span class="line">ens33</span><br></pre></td></tr></table></figure>

<h4 id="2-修改脚本文件"><a href="#2-修改脚本文件" class="headerlink" title="2.修改脚本文件"></a>2.修改脚本文件</h4><p>在 compute 节点配置 &#x2F;etc&#x2F;xiandian&#x2F;openrc.sh 文件 ，根据环境情况修改参数，块存储服务的后端使用第二块硬盘的第一个分区，生效该参数文件 。</p>
<p>请将<code>echo $INTERFACE_IP &amp;&amp; echo $BLOCK_DISK</code>命令的返回结果提交到答题框。【0.5分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$INTERFACE_IP</span> &amp;&amp; <span class="built_in">echo</span> <span class="variable">$BLOCK_DISK</span></span><br><span class="line">192.168.100.200</span><br><span class="line">vdb1</span><br></pre></td></tr></table></figure>

<h4 id="3-安装openstack包"><a href="#3-安装openstack包" class="headerlink" title="3.安装openstack包"></a>3.安装openstack包</h4><p>分别在controller节点和compute节点执行iaas-pre-host.sh文件(不需要重启云主机)。 </p>
<p>在controller节点请将<code>openstack --version</code>命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iaas-pre-host.sh</span><br><span class="line">openstack --version</span><br></pre></td></tr></table></figure>

<h4 id="4-搭建数据库组件"><a href="#4-搭建数据库组件" class="headerlink" title="4.搭建数据库组件"></a>4.搭建数据库组件</h4><p>在controller 节点执行 iaas-install-mysql.sh 脚本， 会自行安装 mariadb 、 memcached 、rabbitmq 等服务和完成相关配置。执行完成后修改配置文件将缓存 CACHESIZE 修改为 128,并重启相应服务 。</p>
<p>请将 <code>ps aux|grep memcached</code> 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-mysql.sh</span><br><span class="line">sed -i <span class="string">&#x27;s/64/128/g&#x27;</span> /etc/sysconfig/memcached</span><br><span class="line">systemctl restart memcached</span><br><span class="line">ps aux|grep memcached</span><br></pre></td></tr></table></figure>

<h4 id="5-搭建认证服务组件"><a href="#5-搭建认证服务组件" class="headerlink" title="5.搭建认证服务组件"></a>5.搭建认证服务组件</h4><p>在 controller 节点 执行 iaas-install-keystone.sh 脚本，会自行安装 keystone 服务 和 完成相关配置。使用 openstack 命令， 创建一个名为 tom 的账户，密码为 tompassword123, 邮箱为 <code>tom@example.com</code> 。</p>
<p>请将 openstack user list 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-keystone.sh</span><br><span class="line"><span class="built_in">source</span> /etc/keystone/admin-openrc.sh</span><br><span class="line">openstack user create --email tom@example.com --password tompassword123 --domain demo tom</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> openstack user list</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| ID                               | Name  |</span><br><span class="line">+----------------------------------+-------+</span><br><span class="line">| 0f024f8839b242dd80534e51fe4bd13f | admin |</span><br><span class="line">| 257f9516cac94ca0a191a27b0e56fa37 | demo  |</span><br><span class="line">| 70f3fccf5f164331b6e688b14d1037d7 | tom   |</span><br><span class="line">+----------------------------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="6-搭建镜像服务组件"><a href="#6-搭建镜像服务组件" class="headerlink" title="6.搭建镜像服务组件"></a>6.搭建镜像服务组件</h4><p>在 controller 节点 执行 iaas-install-glance.sh 脚本， 会 自行安装 glance 服务和完成相关配置。完成后使用 openstack 命令创建一个名为 cirros 的镜像，镜像文件使用 cirros-0.3.0-x86_64-disk.img 。</p>
<p>请将 openstack image show cirros 命令 的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-glance.sh</span><br><span class="line">openstack image create --container-format bare --disk-format qcow2 --file cirros-0.3.0-x86_64-disk.img cirros </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">openstack image show cirros</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | 50bdc35edb03a38d91b1b071afb20a3c                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | 2020-04-04T02:13:37Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | /v2/images/bab32212-e303-4de3-b0b4-e438665db844/file |</span><br><span class="line">| <span class="built_in">id</span>               | bab32212-e303-4de3-b0b4-e438665db844                 |</span><br><span class="line">| min_disk         | 0                                                    |</span><br><span class="line">| min_ram          | 0                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | f4157a956a6840dbb77f22554c4f1e9c                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | /v2/schemas/image                                    |</span><br><span class="line">| size             | 9761280                                              |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | 2020-04-04T02:13:37Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | shared                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="7-搭建计算服务组件"><a href="#7-搭建计算服务组件" class="headerlink" title="7.搭建计算服务组件"></a>7.搭建计算服务组件</h4><p>在 controller 节点执行 iaas-install-nova-controller.sh compute 节点执行 iaas-install-nova-compute.sh ，会自行安装 nova 服务和完成相关配置。使用 nova 命令创建一个名为 t,ID 为 5 ，内存为 2048MB, 磁盘容量为 10GB,vCPU 数量为 2 的云主机类型。</p>
<p>在 controller 节点 请将 nova flavor show t 命令的返回结果提交到答题框。【 1 分】</p>
<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-nova-controller.sh</span><br><span class="line">nova flavor-create t 5 2048 10 2</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-nova-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">nova flavor-show t </span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| Property                   | Value |</span><br><span class="line">+----------------------------+-------+</span><br><span class="line">| OS-FLV-DISABLED:disabled   | False |</span><br><span class="line">| OS-FLV-EXT-DATA:ephemeral  | 0     |</span><br><span class="line">| description                | -     |</span><br><span class="line">| disk                       | 10    |</span><br><span class="line">| extra_specs                | &#123;&#125;    |</span><br><span class="line">| <span class="built_in">id</span>                         | 5     |</span><br><span class="line">| name                       | t     |</span><br><span class="line">| os-flavor-access:is_public | True  |</span><br><span class="line">| ram                        | 2048  |</span><br><span class="line">| rxtx_factor                | 1.0   |</span><br><span class="line">| swap                       |       |</span><br><span class="line">| vcpus                      | 2     |</span><br><span class="line">+----------------------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="8-搭建网络组件并初始化网络"><a href="#8-搭建网络组件并初始化网络" class="headerlink" title="8.搭建网络组件并初始化网络"></a>8.搭建网络组件并初始化网络</h4><p>在 controller 节点执行 iaas-install-neutron-controller.sh,compute 节点执行 iaas-install-neutron-compute.sh ，会自行安装 neutron 服务并完成配置。创建云主机外部网络 ext-net ，子网为 ext-subnet ，云主机浮动 IP 可用网段为 192.168.10.100~192.168.10.200 网关为 192.168.100.1 。</p>
<p>在 controller 节点 请 将 openstack subnet show ext-subnet 命令 的 返回结果提交到答题框。【 1 分】</p>
<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-neutron-controller.sh</span><br><span class="line">openstack network create ext-net --external</span><br><span class="line">openstack subnet create ext-subnet --network ext-net --gateway 192.168.100.1 --subnet-range 192.168.10.0/24 --allocation-pool start=192.168.10.100,end=192.168.10.200 </span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-neutron-compute.sh </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">openstack subnet show ext-subnet</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| Field             | Value                                |</span><br><span class="line">+-------------------+--------------------------------------+</span><br><span class="line">| allocation_pools  | 192.168.10.100-192.168.10.200        |</span><br><span class="line">| cidr              | 192.168.10.0/24                      |</span><br><span class="line">| created_at        | 2020-04-04T02:30:16Z                 |</span><br><span class="line">| description       |                                      |</span><br><span class="line">| dns_nameservers   |                                      |</span><br><span class="line">| enable_dhcp       | True                                 |</span><br><span class="line">| gateway_ip        | 192.168.100.1                        |</span><br><span class="line">| host_routes       |                                      |</span><br><span class="line">| <span class="built_in">id</span>                | a82d808b-7cf7-430e-8573-5ced16c62f5f |</span><br><span class="line">| ip_version        | 4                                    |</span><br><span class="line">| ipv6_address_mode | None                                 |</span><br><span class="line">| ipv6_ra_mode      | None                                 |</span><br><span class="line">| name              | ext-subnet                           |</span><br><span class="line">| network_id        | 625fe270-669f-449e-af14-dadeef733b9e |</span><br><span class="line">| project_id        | f4157a956a6840dbb77f22554c4f1e9c     |</span><br><span class="line">| revision_number   | 0                                    |</span><br><span class="line">| segment_id        | None                                 |</span><br><span class="line">| service_types     |                                      |</span><br><span class="line">| subnetpool_id     | None                                 |</span><br><span class="line">| tags              |                                      |</span><br><span class="line">| updated_at        | 2020-04-04T02:30:16Z                 |</span><br><span class="line">+-------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="9-搭建形化界面"><a href="#9-搭建形化界面" class="headerlink" title="9.搭建形化界面"></a>9.搭建形化界面</h4><p>在 controller 节点执行 iaas-install-dashboard.sh 脚本， 会自行安装 dashboard 服务并完成配置。请修改 nova 配置文件，使之能通过公网 IP 访问 dashboard 首页。</p>
<p>在 controller 节点 请将 <code>curl http://EIP/dashboard -L</code>  命令 的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-dashboard.sh</span><br><span class="line">curl http://192.168.100.200/dashboard -L</span><br></pre></td></tr></table></figure>

<h3 id="任务-3-OpenStack-运维任务（-13-分）"><a href="#任务-3-OpenStack-运维任务（-13-分）" class="headerlink" title="任务 3 OpenStack 运维任务（ 13 分）"></a>任务 3 OpenStack 运维任务（ 13 分）</h3><p>某公司构建了一套内部私有云系统，这套私有云系统将为公司内部提供计算服务。你将</p>
<p>作为该私有云的维护人员，请完成以下运维工作。</p>
<h4 id="1-安全组管理"><a href="#1-安全组管理" class="headerlink" title="1.安全组管理"></a>1.安全组管理</h4><p>使用命令创建名称为 group_web 的安全组该安全组的描述为 Custom security group 用 openstack 命令为安全组添加 icmp 规则和 ssh 规则 允许任意 ip 地址访问 web 完成后查看该安全组的详细信息</p>
<p>将 openstack security group show group_web 命令 的 返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack security group create group_web --description <span class="string">&quot;Custom security group&quot;</span></span><br><span class="line">openstack security group rule create --protocol icmp --ingress group_web</span><br><span class="line">openstack security group rule create --ingress --protocol tcp --dst-port 22:22 group_web</span><br><span class="line">openstack security group show group_web</span><br></pre></td></tr></table></figure>

<h4 id="2-项目管理"><a href="#2-项目管理" class="headerlink" title="2.项目管理"></a>2.项目管理</h4><p>在 keystone 中创建 shop 项目添加描述为 “Hello shop” ，完成后使用 openstack 命令禁用该项目 。</p>
<p>请将 openstack project show shop 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack project create shop --description <span class="string">&quot;Hello shop&quot;</span> --domain demo</span><br><span class="line">openstack project <span class="built_in">set</span> shop --<span class="built_in">disable</span> --domain demo</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">openstack project show shop</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Hello shop                       |</span><br><span class="line">| domain_id   | 000a54d41fc046499b0d8b181974c54d |</span><br><span class="line">| enabled     | False                            |</span><br><span class="line">| <span class="built_in">id</span>          | edc71a9e411c4feea307699b4b9b1e41 |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | shop                             |</span><br><span class="line">| parent_id   | 000a54d41fc046499b0d8b181974c54d |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="3-用户管理"><a href="#3-用户管理" class="headerlink" title="3.用户管理"></a>3.用户管理</h4><p>使用 nova 命令查看 admin 租户的当前配额值，将 admin 租户的实例配额提升到 13 。</p>
<p>请将 nova quota-class show admin 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nova quota-class-update --instances 13 admin</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nova quota-class-show admin</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Quota                | Limit |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| instances            | 13    |</span><br><span class="line">| cores                | 20    |</span><br><span class="line">| ram                  | 51200 |</span><br><span class="line">| metadata_items       | 128   |</span><br><span class="line">| key_pairs            | 100   |</span><br><span class="line">| server_groups        | 10    |</span><br><span class="line">| server_group_members | 10    |</span><br><span class="line">+----------------------+-------+</span><br></pre></td></tr></table></figure>

<h4 id="4-镜像管理"><a href="#4-镜像管理" class="headerlink" title="4.镜像管理"></a>4.镜像管理</h4><p>登录 controller 节点 ，使用 glance 相关命令上传镜像，源使用 CentOS_7.5_x86_64_XD.qcow2 ，名字为 centos7.5 ，修改这个镜像为共享状态并设置最小磁盘 为 5G 。</p>
<p>请将 glance image-list 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glance image-create --name centos7.5 --disk-format qcow2 --container-format bare --min-disk 5 --progress &lt; /opt/iaas/images/CentOS_7.5_x86_64_XD.qcow2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">glance image-list</span><br><span class="line">+--------------------------------------+-----------+</span><br><span class="line">| ID                                   | Name      |</span><br><span class="line">+--------------------------------------+-----------+</span><br><span class="line">| c0e2026e-acc7-4bf3-9c46-6223fefb299c | centos7.5 |</span><br><span class="line">| bab32212-e303-4de3-b0b4-e438665db844 | cirros    |</span><br><span class="line">+--------------------------------------+-----------+</span><br></pre></td></tr></table></figure>

<h4 id="5-后端配置文件管理"><a href="#5-后端配置文件管理" class="headerlink" title="5.后端配置文件管理"></a>5.后端配置文件管理</h4><p>请修改 glance 后端配置文件， 将项目的映像存储限制为 10GB 完成后重启 glance 服务。</p>
<p>请将 <code>cat /etc/glance/glance-api.conf |grep user_storage</code> 命令的返回结果提交到答题框。【 1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/#user_storage_quota=/user_storage_quota=10737418240/g&#x27;</span> /etc/glance/glance-api.conf</span><br><span class="line">systemctl restart *glance*</span><br><span class="line"><span class="built_in">cat</span> /etc/glance/glance-api.conf |grep user_storage</span><br></pre></td></tr></table></figure>

<h4 id="6-存储服务管理"><a href="#6-存储服务管理" class="headerlink" title="6.存储服务管理"></a>6.存储服务管理</h4><p>在 controller 节点执行 iaas-install-cinder-controller.sh , compute 节点 执行 iaas-install-cinder-compute.sh ，在 controller 和 compute 节点上会自行安装 cinder 服务并完成配置。 创建一个名为 lvm 的卷类型， 创建该类型规格键值对，要求 lvm 卷类型对应 cinder 后端驱动 lvm 所管理的存储资源名字 lvm_test ，大小 1G 的云硬盘并查询该云硬盘的详细信息。</p>
<p>请将 cinder show lvm_test命令的返回结果提交到答题框。【1分】</p>
<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-cinder-controller.sh</span><br><span class="line">openstack volume <span class="built_in">type</span> create lvm </span><br><span class="line">openstack volume create --<span class="built_in">type</span> lvm --size 1 lvm_test</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-cinder-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cinder show lvm_test</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| Property                       | Value                                |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br><span class="line">| attached_servers               | []                                   |</span><br><span class="line">| attachment_ids                 | []                                   |</span><br><span class="line">| availability_zone              | nova                                 |</span><br><span class="line">| bootable                       | <span class="literal">false</span>                                |</span><br><span class="line">| consistencygroup_id            | None                                 |</span><br><span class="line">| created_at                     | 2020-04-04T05:29:27.000000           |</span><br><span class="line">| description                    | None                                 |</span><br><span class="line">| encrypted                      | False                                |</span><br><span class="line">| <span class="built_in">id</span>                             | 34b82874-b96e-47de-8aa6-b94a653dbe44 |</span><br><span class="line">| metadata                       |                                      |</span><br><span class="line">| migration_status               | None                                 |</span><br><span class="line">| multiattach                    | False                                |</span><br><span class="line">| name                           | lvm_test                             |</span><br><span class="line">| os-vol-host-attr:host          | None                                 |</span><br><span class="line">| os-vol-mig-status-attr:migstat | None                                 |</span><br><span class="line">| os-vol-mig-status-attr:name_id | None                                 |</span><br><span class="line">| os-vol-tenant-attr:tenant_id   | f4157a956a6840dbb77f22554c4f1e9c     |</span><br><span class="line">| replication_status             | None                                 |</span><br><span class="line">| size                           | 1                                    |</span><br><span class="line">| snapshot_id                    | None                                 |</span><br><span class="line">| source_volid                   | None                                 |</span><br><span class="line">| status                         | error                                |</span><br><span class="line">| updated_at                     | 2020-04-04T05:29:27.000000           |</span><br><span class="line">| user_id                        | 0f024f8839b242dd80534e51fe4bd13f     |</span><br><span class="line">| volume_type                    | lvm                                  |</span><br><span class="line">+--------------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>

<h4 id="7-数据库管理"><a href="#7-数据库管理" class="headerlink" title="7.数据库管理"></a>7.数据库管理</h4><p>请使用数据库命令将所有数据库进行备份备份文件名为 openstack. sql ，完成后使用命令查看文件属性其中文件大小以 mb 显示。</p>
<p>请将 <code>du -h openstack.sql</code>命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p000000 --opt  --all-databases &gt; openstack.sql</span><br><span class="line"><span class="built_in">du</span> -h openstack.sql</span><br></pre></td></tr></table></figure>

<h4 id="8-数据库管理"><a href="#8-数据库管理" class="headerlink" title="8.数据库管理"></a>8.数据库管理</h4><p>进入数据库，创建本地用户 examuser ，密码为 000000 ，然后查询 mysql 数据库中的 user 表的 user,host,password 字段。 然后赋予这个用户所有数据库的查询删除更新创建的权限。<br>请将 <code>select user,host,password from user;</code> 命令的返回结果提 交到答题框【 1 分】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> mysql.user(host,<span class="keyword">user</span>,password) <span class="keyword">values</span>(&quot;localhost&quot;,&quot;examuser&quot;,password(&quot;000000&quot;));</span><br><span class="line">use mysql;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">delete</span>,<span class="keyword">update</span>,<span class="keyword">create</span> <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> examuser@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;000000&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> host,<span class="keyword">user</span>,password <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure>

<h4 id="9-存储管理"><a href="#9-存储管理" class="headerlink" title="9.存储管理"></a>9.存储管理</h4><p>请使用 openstack 命令创建一个名为 test 的 cinder 卷，卷大小为 5G 。完成后使用 cinder 命令列出卷列表并查看 test 卷的详细信息。</p>
<p>请将 cinder list 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack volume create <span class="built_in">test</span> --<span class="built_in">type</span> lvm --size 5 </span><br><span class="line">cinder list</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cinder list</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+----------+-------------+</span><br><span class="line">| ID                                   | Status | Name     | Size | Volume Type | Bootable | Attached to |</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+----------+-------------+</span><br><span class="line">| 34b82874-b96e-47de-8aa6-b94a653dbe44 | error  | lvm_test | 1    | lvm         | <span class="literal">false</span>    |             |</span><br><span class="line">| e06df5d4-5510-4855-8b84-95ef7a39fcbe | error  | <span class="built_in">test</span>     | 5    | lvm         | <span class="literal">false</span>    |             |</span><br><span class="line">+--------------------------------------+--------+----------+------+-------------+----------+-------------+</span><br></pre></td></tr></table></figure>

<h4 id="10-存储管理"><a href="#10-存储管理" class="headerlink" title="10.存储管理"></a>10.存储管理</h4><p>为了减缓来自实例的数据访问速度的变慢， OpenStack Block Storage 支持对卷数据复制带宽的速率限制。 请修改 cinder 后端配置文件将卷复制带宽限制为最高 100 MiB&#x2F;s 。<br>请将 <code>cat /etc/cinder/cinder.conf |grep volume_copy</code> 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/#volume_copy_bps_limit = 0/volume_copy_bps_limit = 104857600/g&#x27;</span> /etc/cinder/cinder.conf</span><br><span class="line">systemctl restart *cinder*</span><br><span class="line"><span class="built_in">cat</span> /etc/cinder/cinder.conf |grep volume_copy</span><br></pre></td></tr></table></figure>

<h4 id="11-存储管理"><a href="#11-存储管理" class="headerlink" title="11.存储管理"></a>11.存储管理</h4><p>在 controller 节点执行 iaas-install-swift-controller.sh, compute 节点执行 iaas-install-swift-compute.sh，在 controller 和 compute 节点上会自行安装 swift 服务并完成配置。创建一个名为 file 的容器。</p>
<p>请将 swift stat file 命令的返回结果提交到答题框【1分】</p>
<p><strong>controller</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-swift-controller.sh</span><br><span class="line">swift post file</span><br></pre></td></tr></table></figure>

<p><strong>compute</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iaas-install-swift-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; swift <span class="built_in">stat</span> file</span><br><span class="line">               Account: AUTH_f4157a956a6840dbb77f22554c4f1e9c</span><br><span class="line">             Container: file</span><br><span class="line">               Objects: 0</span><br><span class="line">                 Bytes: 0</span><br><span class="line">              Read ACL:</span><br><span class="line">             Write ACL:</span><br><span class="line">               Sync To:</span><br><span class="line">              Sync Key:</span><br><span class="line">         Accept-Ranges: bytes</span><br><span class="line">      X-Storage-Policy: Policy-0</span><br><span class="line">         Last-Modified: Tue, 04 Apr 2020 06:01:01 GMT</span><br><span class="line">           X-Timestamp: 1680588060.62390</span><br><span class="line">            X-Trans-Id: txd95c541987884cfbbaafc-00642bbd29</span><br><span class="line">          Content-Type: application/json; charset=utf-8</span><br><span class="line">X-Openstack-Request-Id: txd95c541987884cfbbaafc-00642bbd29</span><br></pre></td></tr></table></figure>

<h4 id="12-存储管理"><a href="#12-存储管理" class="headerlink" title="12.存储管理"></a>12.存储管理</h4><p>用 swift命令，把 cirros-0.3.4-x86_64-disk.img上传到 file容器中。 请将 swift list file 命令 的返回 结果提交到答题框【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swift upload file cirros-0.3.4-x86_64-disk.img</span><br><span class="line">swift list file</span><br></pre></td></tr></table></figure>

<h4 id="13-添加控制节点资源到云平台"><a href="#13-添加控制节点资源到云平台" class="headerlink" title="13.添加控制节点资源到云平台"></a>13.添加控制节点资源到云平台</h4><p>修改 openrc.sh中的内容，然后在 controller 节点执行 iaas-install-nova-compute.sh，把 controller 节点的资源添加到云平台。 </p>
<p>请将 openstack compute service list 命令 的返回 结果提交到答题框【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/xiandian-iaas/openrc.sh</span><br><span class="line">HOST_NAME_NODE=controller</span><br><span class="line">HOST_IP_NODE=172.17.2.10</span><br><span class="line"><span class="built_in">source</span> /etc/xiandian-iaas/openrc.sh</span><br><span class="line">iaas-install-nova-compute.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">openstack compute service list</span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary           | Host       | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  1 | nova-scheduler   | controller | internal | enabled | up    | 2020-04-04T06:07:51.000000 |</span><br><span class="line">|  2 | nova-consoleauth | controller | internal | enabled | up    | 2020-04-04T06:07:51.000000 |</span><br><span class="line">|  3 | nova-conductor   | controller | internal | enabled | up    | 2020-04-04T06:07:49.000000 |</span><br><span class="line">|  7 | nova-compute     | compute    | nova     | enabled | up    | 2020-04-04T06:07:47.000000 |</span><br><span class="line">|  8 | nova-compute     | controller | nova     | enabled | up    | 2020-04-04T06:07:51.000000 |</span><br><span class="line">+----+------------------+------------+----------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>

<h3 id="任务四-OpenStack-架构-任务-3-分"><a href="#任务四-OpenStack-架构-任务-3-分" class="headerlink" title="任务四 OpenStack 架构 任务 3 分"></a>任务四 OpenStack 架构 任务 3 分</h3><p>公司内部拥有一套私有云系统，为了调试该私有云，需要编写一些测试用脚本进行功能性测试，作为公司私有云维护人员请你完成以下工作。</p>
<h4 id="1-创建浮动IP"><a href="#1-创建浮动IP" class="headerlink" title="1.创建浮动IP"></a>1.创建浮动IP</h4><p>请使用 openstack 命令创建一个浮动 IP 地址，完成后使用 openstack 命令查看该浮动 IP 的 id ，请编写一个名为 floating_show.sh 的脚本，该脚本 <code>$1</code> 变量为浮动 ip 的 id ，对接 neutron 服务端点获取该浮动 IP 的详细信息。脚本使用 curl 向 api 端点传递参数，为了兼容性考虑不得出现 openstack 命令。</p>
<p>请将 floating_show.sh 中 部分替换为正 常内容并 提交到答题框【 1.5 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">openstack floating ip create ext-net</span><br><span class="line">openstack floating ip show &lt;ip&gt;</span><br><span class="line"><span class="comment"># 获取 token</span></span><br><span class="line">curl -v -s -X POST <span class="variable">$OS_AUTH_URL</span>/auth/tokens?nocatalog   -H <span class="string">&quot;Content-Type: application/json&quot;</span>   -d <span class="string">&#x27;&#123; &quot;auth&quot;: &#123; &quot;identity&quot;: &#123; &quot;methods&quot;: [&quot;password&quot;],&quot;password&quot;: &#123;&quot;user&quot;: &#123;&quot;domain&quot;: &#123;&quot;name&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$OS_USER_DOMAIN_NAME</span>&quot;</span><span class="string">&#x27;&quot;&#125;,&quot;name&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$OS_USERNAME</span>&quot;</span><span class="string">&#x27;&quot;, &quot;password&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$OS_PASSWORD</span>&quot;</span><span class="string">&#x27;&quot;&#125; &#125; &#125;, &quot;scope&quot;: &#123; &quot;project&quot;: &#123; &quot;domain&quot;: &#123; &quot;name&quot;: &quot;&#x27;</span><span class="string">&quot;<span class="variable">$OS_PROJECT_DOMAIN_NAME</span>&quot;</span><span class="string">&#x27;&quot; &#125;, &quot;name&quot;:  &quot;&#x27;</span><span class="string">&quot;<span class="variable">$OS_PROJECT_NAME</span>&quot;</span><span class="string">&#x27;&quot; &#125; &#125; &#125;&#125;&#x27;</span> \</span><br><span class="line">| python -m json.tool</span><br><span class="line"><span class="comment"># 将 token 应用到环境变量</span></span><br><span class="line"><span class="built_in">export</span> OS_TOKEN=&lt;X-Subject-Token:&gt;</span><br><span class="line"><span class="comment"># 获取该浮动 ip 的 id</span></span><br><span class="line">neutron floatingip-list</span><br><span class="line">neatron floatingip-show &lt;ip&gt;</span><br></pre></td></tr></table></figure>

<p><code>floating_show.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$1</span> = 15991162-9175-4aa7-a0ea-d2be78e755cb</span><br><span class="line">curl -g -i -X GET http://controller:9696/v2.0/floatingips/<span class="variable">$1</span> -H <span class="string">&quot;User-Agent: python-neutronclient&quot;</span> -H <span class="string">&quot;Accept: application/json&quot;</span> -H <span class="string">&quot;X-Auth-Token: <span class="variable">$OS_TOKEN</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-删除浮动IP"><a href="#2-删除浮动IP" class="headerlink" title="2.删除浮动IP"></a>2.删除浮动IP</h4><p>请编写脚本 floating_delete.sh ，完成浮动 IP 的删除。设置一个 <code>$1</code> 变量，当用户向 <code>$1</code> 传递一个浮动 IP 的 id ，即可完成该浮动 IP 的删除。脚本使用 curl 向 api 端点传递参数，为了兼容性考虑不得出现 openstack 命令。</p>
<p>请将 floating_show.sh中*部分替换为正常内容并提交到答题框【1.5分】</p>
<p><code>floating_delete.sh</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$1</span></span><br><span class="line">curl -g -i -X DELETE http://controller:9696/v2.0/floatingips/<span class="variable">$1</span> -H <span class="string">&quot;User-Agent: python-neutronclient&quot;</span> -H <span class="string">&quot;Accept: application/json&quot;</span> -H <span class="string">&quot;X-Auth-Token: <span class="variable">$OS_TOKEN</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="B模块题目：容器的编排与运维"><a href="#B模块题目：容器的编排与运维" class="headerlink" title="B模块题目：容器的编排与运维"></a>B模块题目：容器的编排与运维</h2><p>某企业计划使用 k8s 平台搭建微服务系统，现在先使用简单的微服务项目进行测试，请按照要求完成相应任务。</p>
<table>
<thead>
<tr>
<th align="center">设备名称</th>
<th align="center">主机名</th>
<th align="center">接口</th>
<th align="center">IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">云服务器1</td>
<td align="center">master</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.*.&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器2</td>
<td align="center">node1</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.*.&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器3</td>
<td align="center">node2</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.*.&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器4</td>
<td align="center">harbor</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.*.&#x2F;24</td>
</tr>
</tbody></table>
<h3 id="任务-1-容器云平台环境初始化（-10-分）"><a href="#任务-1-容器云平台环境初始化（-10-分）" class="headerlink" title="任务 1 容器云平台环境初始化（ 10 分）"></a>任务 1 容器云平台环境初始化（ 10 分）</h3><h4 id="1-容器云平台的初始化"><a href="#1-容器云平台的初始化" class="headerlink" title="1.容器云平台的初始化"></a>1.容器云平台的初始化</h4><p>master 节点主机名设置为 master 、 node1 节点 主机名设置为 node1 、 node2 节点 主机名设置为 node2 、 harbor 节点 主机名设置为 harbor, 所有节点关闭 swap ，并配置 hosts 映射。</p>
<p>请在 master 节点将free –m 命令的返回结果提交到答题框。【1分】</p>
<p><strong>ALL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname --static master </span><br><span class="line">hostnamectl set-hostname --static node1 </span><br><span class="line">hostnamectl set-hostname --static node2 </span><br><span class="line">hostnamectl set-hostname --static harbor </span><br><span class="line">swapoff -a </span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.100.110 master</span></span><br><span class="line"><span class="string">192.168.100.120 node1</span></span><br><span class="line"><span class="string">192.168.100.130 node2</span></span><br><span class="line"><span class="string">192.168.100.140 harbor</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">free -m</span><br></pre></td></tr></table></figure>

<h4 id="2-Yum-源数据的持久化挂载"><a href="#2-Yum-源数据的持久化挂载" class="headerlink" title="2.Yum 源数据的持久化挂载"></a>2.Yum 源数据的持久化挂载</h4><p>将提供的 CentOS-7-x86_64-DVD-1804.iso 和 bricsskills_cloud_paas.iso 光盘镜像文件移动到 master 节点 &#x2F;root 目录下，然后在 &#x2F;opt 目录下使用命令创建 centos 目录和 paas 目录，并将镜像文件 CentOS-7-x86_64-DVD-1804.iso 永久挂载到 centos 目录下，将镜像文件 chinaskills_cloud_paas.iso 永久挂载到 &#x2F; paas 目录下。</p>
<p>请在 master 节点 将 <code>df -h</code> 命令 的返回结果提交到答题框。【 1 分】</p>
<p><strong>master</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/centos /opt/paas</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/rc.local &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">mount -o /root/CentOS-7-x86_64-DVD-1804.iso /opt/centos</span></span><br><span class="line"><span class="string">mount -o /root/chinaskills_cloud_paas.iso /opt/paas</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>

<h4 id="3-Yum-源的编写"><a href="#3-Yum-源的编写" class="headerlink" title="3.Yum 源的编写"></a>3.Yum 源的编写</h4><p>在 master 节点首先将系统自带的 yum 源移动到 &#x2F;home 目录，然后 为 master 节点配置本地 yum 源， yum 源文件名为 local.repo 。<br>请将 <code>yum list | grep docker</code>命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /home</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/local.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[centos]</span></span><br><span class="line"><span class="string">name=centos</span></span><br><span class="line"><span class="string">baseurl=file:///opt/centos</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">[k8s]</span></span><br><span class="line"><span class="string">name=k8s</span></span><br><span class="line"><span class="string">baseurl=file:///opt/paas/kubernetes-repo/</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br><span class="line">yum list | grep docker</span><br></pre></td></tr></table></figure>

<h4 id="4-Yum-源的编写"><a href="#4-Yum-源的编写" class="headerlink" title="4.Yum 源的编写"></a>4.Yum 源的编写</h4><p>在 master 节点安装 ftp 服务，将 ftp 共享 目录设置为 &#x2F;opt 。</p>
<p>请将 <code>curl -l ftp://IP</code> 命令的返回结果提交到答题框。【1分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y vsftpd </span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/vsftpd/vsftpd.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">anon_root=/opt</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl <span class="built_in">enable</span> vsftpd --now</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line">setenforce 0</span><br><span class="line">curl -l ftp://192.168.100.110</span><br></pre></td></tr></table></figure>

<h4 id="5-Yum-源的编写"><a href="#5-Yum-源的编写" class="headerlink" title="5.Yum 源的编写"></a>5.Yum 源的编写</h4><p>为 node1 节点和 node2 节点分别配置 ftp 源 yum 源文件名称为 ftp.repo 其中 ftp 服务器地址为 master 节点 配置 ftp 源时不要写 IP 地址，配置之后，两台机器都安装 kubectl 包作为安装测试。</p>
<p>在 node1节点请将 <code>yum list | grep kubectl</code>命令的返回结果提交到答题框。【2分】</p>
<p><strong>node</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /etc/yum.repos.d/* /media</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/ftp.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[centos]</span></span><br><span class="line"><span class="string">name=centos</span></span><br><span class="line"><span class="string">baseurl=ftp://master/centos</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">[k8s]</span></span><br><span class="line"><span class="string">name=k8s</span></span><br><span class="line"><span class="string">baseurl=ftp://master/paas/kubernetes-repo/</span></span><br><span class="line"><span class="string">enable=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum repolist</span><br><span class="line">yum list | grep kubectl</span><br><span class="line">yum install -y kubectl</span><br></pre></td></tr></table></figure>

<h4 id="6-设时间同步服务器"><a href="#6-设时间同步服务器" class="headerlink" title="6.设时间同步服务器"></a>6.设时间同步服务器</h4><p>在 master 节点上部署 chrony 服务器，允许其它节点同步时间，启动服务并设置为开机自启动； 在其他节点上指定 master 节点为上游 NTP 服务器，重启服务并设为开机自启动。</p>
<p>在 node1 节点将 <code>chronyc sources</code> 命令的返回结果提交到答题框。【 2 分】</p>
<p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install -y chrony </span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/chrony.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">server master iburst</span></span><br><span class="line"><span class="string">allow 192.168.100.0/24</span></span><br><span class="line"><span class="string">local stratum 10</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd --now</span><br></pre></td></tr></table></figure>

<p><strong>node &amp; harbor</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/chrony.conf &lt;&lt;EOF</span><br><span class="line">server master iburst</span><br><span class="line">EOF</span><br><span class="line">chronyc sources</span><br></pre></td></tr></table></figure>

<h4 id="7-设置免密登录"><a href="#7-设置免密登录" class="headerlink" title="7.设置免密登录"></a>7.设置免密登录</h4><p>为四台服务器设置免密登录 ，保证服务器之间能够互相免密登录。</p>
<p>在 master 节点将 <code>ssh node1</code> 命令的返回结果提交到答题框。【 2 分】</p>
<p><strong>master</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id root@node1</span><br><span class="line">ssh-copy-id root@node2</span><br><span class="line">ssh-copy-id root@harbor</span><br><span class="line">ssh node1</span><br></pre></td></tr></table></figure>

<h3 id="任务-2-k8s-搭建任务-15-分"><a href="#任务-2-k8s-搭建任务-15-分" class="headerlink" title="任务 2 k8s 搭建任务 15 分"></a>任务 2 k8s 搭建任务 15 分</h3><h4 id="1-安装-docker-应用"><a href="#1-安装-docker-应用" class="headerlink" title="1.安装 docker 应用"></a>1.安装 docker 应用</h4><p>在所有节点上安装 dokcer-ce, 并设置为开机自启动。</p>
<p>在 master 节点 请将 <code>docker version</code> 命令的返回结果提交到答题框。【 1 分】</p>
<p><strong>ALL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce -y</span><br><span class="line">systemctl <span class="built_in">enable</span> docker --now</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<h4 id="2-安装-docker-应用"><a href="#2-安装-docker-应用" class="headerlink" title="2.安装 docker 应用"></a>2.安装 docker 应用</h4><p>所有节点配置阿里云镜像加速地址 <code>https://5twf62k1.mirror.aliyuncs.com</code> 并把启动引擎设置为 systemd ，配置成功重启 docker 服务。</p>
<p>请将 json 文件中 的内容提交到答题框。【 1 分】</p>
<p><strong>ALL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	&quot;registry-mirrors&quot;:[&quot;https://5twf62k1.mirror.aliyuncs.com&quot;],</span></span><br><span class="line"><span class="string">	&quot;exec-opts&quot;:[&quot;native.cgroupdriver=systemd&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h4 id="3-安装-docker-compose"><a href="#3-安装-docker-compose" class="headerlink" title="3.安装 docker compose"></a>3.安装 docker compose</h4><p>在 Harbor 节点创建目录 &#x2F;opt&#x2F;paas 并把 bricsskills_cloud_paas.iso ，挂载到 &#x2F;opt&#x2F;paas 目录下，使用 &#x2F;opt&#x2F;paas&#x2F;docker-compose&#x2F;v1.25.5-docker-compose-Linux-x86_64 文件安装 docker compose 。安装完成后 执行 <code>docker compose version</code> 命令。</p>
<p>请将 docker compose version 命令返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/paas</span><br><span class="line">mount -o bricsskills_cloud_paas.iso /opt/paas</span><br><span class="line"><span class="built_in">cp</span> /opt/paas/docker-compose/v1.25.5-docker-compose-Linux-x86_64 /usr/bin/docker-compose</span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<h4 id="4-搭建-horbor-仓库"><a href="#4-搭建-horbor-仓库" class="headerlink" title="4.搭建 horbor 仓库"></a>4.搭建 horbor 仓库</h4><p>在 Harbor 节点使用 &#x2F;opt&#x2F;paas&#x2F;harbor&#x2F;harbor-offline-installer-v2.1.0.tgz 离线安装包，安装 harbor 仓库，并修改各节点默认 docker 仓库为 harbor 仓库地址 。</p>
<p>在 master 节点请将 docker login harbor private ip 命令 的返回结果提交到答题框。【1分】</p>
<p><strong>harbor</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /opt/paas/harbor/harbor-offline-installer-v2.1.0.tgz .</span><br><span class="line">tar -zxvf /opt/paas/harbor/harbor-offline-installer-v2.1.0.tgz</span><br><span class="line"><span class="built_in">cd</span> harbor</span><br><span class="line"><span class="built_in">mv</span> harbor.yml.tmpl harbor.yml</span><br><span class="line">vim harbor.yml</span><br><span class="line"><span class="comment"># 修改第5行域名；注释 https 及证书部分，修改密码（13/15/18）</span></span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<p><strong>ALL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_forward = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.bridge.bridge-nf-call-ip6tables = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.bridge.bridge-nf-call-iptables = 1&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;insecure-registries&quot;: [&quot;192.168.100.140&quot;],</span></span><br><span class="line"><span class="string">	&quot;registry-mirrors&quot;:[&quot;https://5twf62k1.mirror.aliyuncs.com&quot;],</span></span><br><span class="line"><span class="string">	&quot;exec-opts&quot;:[&quot;native.cgroupdriver=systemd&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line">docker login 192.168.100.140</span><br></pre></td></tr></table></figure>

<h4 id="5-上传-docker-镜像"><a href="#5-上传-docker-镜像" class="headerlink" title="5.上传 docker 镜像"></a>5.上传 docker 镜像</h4><p>在 master 节点使用命令将 &#x2F;opt&#x2F;paas&#x2F;images 目录下所有镜像导入本地 。 然后使用 &#x2F;opt&#x2F;paas&#x2F;k8s_image_push.sh 将所有镜像上传至 docker 仓库 。</p>
<p>在 master 节点 请将 <code>docker images | grep wordpress</code> 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/paas/images </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `<span class="built_in">ls</span>`;<span class="keyword">do</span> docker image load -i <span class="variable">$i</span>;<span class="keyword">done</span>;</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">./k8s_image_push.sh</span><br><span class="line">docker images | grep wordpress</span><br></pre></td></tr></table></figure>

<h4 id="6-安装-kubeadm-工具"><a href="#6-安装-kubeadm-工具" class="headerlink" title="6.安装 kubeadm 工具"></a>6.安装 kubeadm 工具</h4><p>在 master 节点、node1 节点、node2 节点分别安装 Kubeadm 工具 并设置 为 开机自启动 。</p>
<p>在 master 节点 请将 <code>kubeadm version</code> 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install kubeadm -y </span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet --now</span><br><span class="line">kubeadm version</span><br></pre></td></tr></table></figure>

<h4 id="7-初始化-master-节点"><a href="#7-初始化-master-节点" class="headerlink" title="7.初始化 master 节点"></a>7.初始化 master 节点</h4><p>使用 kubeadm 命令生成 yaml 文件，并修改 yaml 文件 ，设置 kubernetes 虚拟内部网段地址为 10.244.0.0&#x2F;16 通过该 yaml 文件初始化 master 节点 然后使用 kube-flannel.yaml 完成控制节点初始化设置。<br>在 master 节点的 kube-flannel.yaml 执行前 将 <code>kubectl get nodes</code> 命令的返回结果提交到答题框。【 1 分】</p>
<p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.18.1 --apiserver-advertise-address=192.168.100.110 --image-repository 192.168.100.140/library --pod-network-cidr=10.244.0.0/16</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">kubectl get pod -n kube-system -owide</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p><strong>node</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> 192.168.100.110:6443 --token l616jt.p5w90k5l0ggzvb0a \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:a06d174657ac8c4a46e9a5e18608712a94308741fa0f448e015afe4e14f09820</span><br></pre></td></tr></table></figure>

<h4 id="8-删除污点"><a href="#8-删除污点" class="headerlink" title="8.删除污点"></a>8.删除污点</h4><p>使用命令删除 master 节点的污点，使得 Pod 也可以调度到 master 节点上。</p>
<p>在 master 节点 请将 <code>kubectl get nodes -o yaml master | grep -A10 spec</code> 命令的返回结果提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes master node-role.kubernetes.io/master-</span><br><span class="line">kubectl get nodes -o yaml master | grep -A10 spec</span><br></pre></td></tr></table></figure>

<h4 id="9-安装-kubernetes-网络插件"><a href="#9-安装-kubernetes-网络插件" class="headerlink" title="9.安装 kubernetes 网络插件"></a>9.安装 kubernetes 网络插件</h4><p>使用 kube-flannel.yaml 安装 kubernetes 网络插件，安装完成后使用命令查看节点状态。</p>
<p>在 master 节点请将 kubectl get nodes 命令的返回结果提交到答题框。【1分】</p>
<p><strong>master</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s/quay.io\/coreos/192.168.100.140\/library/g&quot;</span> /opt/paas/yaml/flannel/kube-flannel.yaml</span><br><span class="line">kubectl apply -f /opt/paas/yaml/flannel/kube-flannel.yaml</span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<h4 id="10-给-kubernetes-创建证书"><a href="#10-给-kubernetes-创建证书" class="headerlink" title="10.给 kubernetes 创建证书"></a>10.给 kubernetes 创建证书</h4><p>在 master节点请将 <code>kubectl get csr</code>命令的返回结果提交到答题框。【2分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> dashboard-certs</span><br><span class="line"><span class="built_in">cd</span> dashboard-certs/</span><br><span class="line"></span><br><span class="line">openssl genrsa -out dashboard.key 2048</span><br><span class="line">openssl req -days 36000 -new -out dashboard.csr -key dashboard.key -subj <span class="string">&#x27;/CN=dashboard-cert&#x27;</span></span><br><span class="line">openssl x509 -req -<span class="keyword">in</span> dashboard.csr -signkey dashboard.key -out dashboard.crt</span><br></pre></td></tr></table></figure>

<h4 id="11-kubernetes-图形化界面的安装"><a href="#11-kubernetes-图形化界面的安装" class="headerlink" title="11.kubernetes 图形化界面的安装"></a>11.kubernetes 图形化界面的安装</h4><p>使用 recommended.yaml 和 dashboard-adminuser.yaml 安装 kubernetes dashboard 界面，完成后查看首页 。</p>
<p>请将 <code>kubectl get pod,svc -n kubernetes dashboard</code> 命令的返回结果提交到答题框。【 2 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace kubernetes-dashboard</span><br><span class="line">kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard</span><br><span class="line">sed -i <span class="string">&quot;s/kubernetesui/192.168.100.140\/library/g&quot;</span> /opt/paas/yaml/dashboard/recommended.yaml</span><br><span class="line">kubectl apply -f /opt/paas/yaml/dashboard/recommended.yaml</span><br><span class="line">kubectl apply -f /opt/paas/yaml/dashboard/dashboard-adminuser.yaml</span><br><span class="line">kubectl get pod,svc -n kubernetes-dashboard</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取token</span></span><br><span class="line">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep dashboard-admin | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># 在 Web Browser 中登录</span></span><br></pre></td></tr></table></figure>

<h4 id="12-扩展计算节点"><a href="#12-扩展计算节点" class="headerlink" title="12.扩展计算节点"></a>12.扩展计算节点</h4><p>在 node1 节点和 node2 节点分别 使用 kubeadm config 命令生成 yaml 文件，并通过 yaml文件 将 node 节点加入 kubernetes 集群。完成后在 master 节点上查看所有节点状态。</p>
<p>在 master 节点请将 <code>kubectl get nodes</code> 命令的返回结果提交到答题框。【2分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上方已包含了该操作</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<h3 id="任务-3-EFK-日志平台构建-15-分"><a href="#任务-3-EFK-日志平台构建-15-分" class="headerlink" title="任务 3 EFK 日志平台构建 15 分"></a>任务 3 EFK 日志平台构建 15 分</h3><h4 id="1-导入镜像"><a href="#1-导入镜像" class="headerlink" title="1.导入镜像"></a>1.导入镜像</h4><p>将提供的 efk-img.tar.gz 压缩包中的镜像导入到 master 节点，并使用命令将镜像上传至 haboor 镜像仓库中。</p>
<p>在 master 节点将 <code>docker images | grep elasticsearch</code> 命令的返回结果 提交到答题框。 【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep elasticsearch</span><br></pre></td></tr></table></figure>

<h4 id="2-NFS-配置"><a href="#2-NFS-配置" class="headerlink" title="2.NFS 配置"></a>2.NFS 配置</h4><p>在 master 节点、 node1 节点、 node2 节点分别安装 nfs 服务， master 节点作为服务端，把 &#x2F;data&#x2F;volume1 目录作为共享目录，只允许 192.168.100 网段访问。</p>
<p>在master 节点，将 <code>showmount -e</code> 命令的返回结果提交到 答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y nfs-utils</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/exports &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">/data/volume1 192.168.100.0/24(rw,sync,no_subtree_check,no_root_squash)</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl <span class="built_in">enable</span> rpc-bind.service nfs</span><br><span class="line">systemctl restart rpc-bind.service nfs</span><br><span class="line">exportfs -rv</span><br><span class="line">showmount -e</span><br></pre></td></tr></table></figure>

<h4 id="3-RBAC-配置"><a href="#3-RBAC-配置" class="headerlink" title="3.RBAC 配置"></a>3.RBAC 配置</h4><p>在 master 节点，编写 sa.yaml ，创建名称为 nfs-provisioner 的 SA 账号。</p>
<p>将 <code>kubectl get serviceaccounts -n kube-logging</code>命令的返回结果提交到答题框。【1分】</p>
<p><code>sa.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>	</span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line"> <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f sa.yaml</span><br><span class="line">kubectl get serviceaccounts -n kube-logging</span><br></pre></td></tr></table></figure>

<h4 id="4-RBAC-配置"><a href="#4-RBAC-配置" class="headerlink" title="4.RBAC 配置"></a>4.RBAC 配置</h4><p>编写 rbac.yaml ，对创建的 sa 账号进行 RBAC 授权，基于 yaml 文件创建完成后使用命令分别查看 sa 账号和 rbac 授权信息。</p>
<p>将 <code>kubectl get roles.rbac.authorization.k8s.io</code> 命令的返回结果提交到答题框 。【 1 分】</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>	</span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">   <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumes&quot;</span>]</span><br><span class="line">   <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;delete&quot;</span>]</span><br><span class="line"> <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">   <span class="attr">resources:</span> [<span class="string">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class="line">   <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>,<span class="string">&quot;update&quot;</span>]</span><br><span class="line"> <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;storage.k8s.io&quot;</span>]</span><br><span class="line">   <span class="attr">resources:</span> [<span class="string">&quot;storageclasses&quot;</span>]</span><br><span class="line">   <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>]</span><br><span class="line"> <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">   <span class="attr">resources:</span> [<span class="string">&quot;events&quot;</span>]</span><br><span class="line">   <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;update&quot;</span>,<span class="string">&quot;patch&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span>	</span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">run-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span>		</span><br><span class="line"> <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">   <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">nfs-provisioner-runner</span></span><br><span class="line"> <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">leader-locking-nfs-provisioner</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">   <span class="attr">resources:</span> [<span class="string">&quot;endpoints&quot;</span>]</span><br><span class="line">   <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;update&quot;</span>,<span class="string">&quot;patch&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">leader-locking-nfs-provisioner</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">nfs-client-provisioner</span></span><br><span class="line">   <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line"></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">leader-locking-nfs-provisioner</span></span><br><span class="line"> <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rbac.yaml</span><br><span class="line">kubectl get roles.rbac.authorization.k8s.io</span><br></pre></td></tr></table></figure>

<h4 id="5-StorageClass动态绑定"><a href="#5-StorageClass动态绑定" class="headerlink" title="5.StorageClass动态绑定"></a>5.StorageClass动态绑定</h4><p>编写 nfs-deploy.yaml 文件，基于 nfs-client-provisioner 镜像创建 nfs-provisioner 的 deployment 对象 ，绑定 nfs 服务端的共享目录。</p>
<p>将 <code>kubectl get pods</code> 命令的返回结果提交到答题框。 【 1 分】</p>
<p><code>nfs-deploy.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line"> <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"> <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">strategy:</span> </span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line"> <span class="attr">selector:</span></span><br><span class="line">  <span class="attr">matchLabels:</span></span><br><span class="line">   <span class="attr">app:</span> <span class="string">nfs-provisioner</span></span><br><span class="line"> <span class="attr">template:</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">  <span class="attr">spec:</span> </span><br><span class="line">   <span class="attr">serviceAccountName:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">   <span class="attr">containers:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">     <span class="attr">image:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.140</span><span class="string">/library/nfs-client-provisioner</span></span><br><span class="line">     <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">     <span class="attr">volumeMounts:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-root</span></span><br><span class="line">       <span class="attr">mountPath:</span> <span class="string">/persistentvolumes</span></span><br><span class="line">     <span class="attr">env:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PROVISIONER_NAME</span></span><br><span class="line">       <span class="attr">value:</span> <span class="string">nfs-provisioner</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_SERVER</span></span><br><span class="line">       <span class="attr">value:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.110</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NFS_PATH</span></span><br><span class="line">       <span class="attr">value:</span> <span class="string">/data/volume1</span></span><br><span class="line">   <span class="attr">volumes:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-root</span></span><br><span class="line">     <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.100</span><span class="number">.110</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data/volume1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-deploy.yaml</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>

<h4 id="6-StorageClass动态绑定"><a href="#6-StorageClass动态绑定" class="headerlink" title="6.StorageClass动态绑定"></a>6.StorageClass动态绑定</h4><p>编写 storageclass.yaml 文件，创建 storageclass 动态绑定 nfs-provisioner ，完成后查看 nfs-provisioner 的 pod 及 storageclasses 对象。</p>
<p>将 <code>kubectl get storageclasses.storage.k8s.io</code> 命令的返回结果提交到答题框 。【 2 分】</p>
<p><code>storageclass.yaml</code> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">storage-test</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">nfs-provisioner</span></span><br></pre></td></tr></table></figure>

<p><code>pvc.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"> <span class="attr">accessModes:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line"> <span class="attr">resources:</span></span><br><span class="line">  <span class="attr">requests:</span></span><br><span class="line">   <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"> <span class="attr">storageClassName:</span> <span class="string">storage-test</span>		</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f storageclass.yaml</span><br><span class="line">kubectl apply -f pvc.yaml</span><br><span class="line">kubectl get storageclasses.storage.k8s.io</span><br></pre></td></tr></table></figure>

<h4 id="7-通过-statefulset-创建-elasticsearch-集群"><a href="#7-通过-statefulset-创建-elasticsearch-集群" class="headerlink" title="7.通过 statefulset 创建 elasticsearch 集群"></a>7.通过 statefulset 创建 elasticsearch 集群</h4><p>编写 es-statefulset.yaml ，通过 yaml 文件构建 elasticsearch 的 statefulset 集群， 集群中有 3 个副本名字分别为 es-cluster-0 、 es-cluster-1 、 es-cluster-2 ，并且使用上述 storageclass 提供的存储，使用 elasticsearch:7.2.0 镜像 ，并且声明 9200 端口为 api 端口， 9300 端口为内部访问端口，并且添加 busybox 的初始化容器对 elasticsearch 的数据目录 &#x2F;usr&#x2F;share&#x2F;elasticsearch&#x2F;data 进行授权操作。</p>
<p>将 <code>kubectl get pods</code> 命令的返回结果提交到 答题框。 【 2 分】</p>
<p><code>es-statefulset.yaml</code> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">es-cluster</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">elasticsearch:7.2.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">1000m</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9200</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">rest</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">9300</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">inter-node</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cluster.name</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">k8s-logs</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">node.name</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">discovery.seed_hosts</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;es-cluster-0.elasticsearch,es-cluster-1.elasticsearch,es-cluster-2.elasticsearch&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cluster.initial_master_nodes</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;es-cluster-0,es-cluster-1,es-cluster-2&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ES_JAVA_OPTS</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;-Xms512m -Xmx512m&quot;</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fix-permissions</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;chown -R 1000:1000 /usr/share/elasticsearch/data&quot;</span>]</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/elasticsearch/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">increase-vm-max-map</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sysctl&quot;</span>, <span class="string">&quot;-w&quot;</span>, <span class="string">&quot;vm.max_map_count=262144&quot;</span>]</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">increase-fd-ulimit</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;ulimit -n 65536&quot;</span>]</span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">accessModes:</span> [ <span class="string">&quot;ReadWriteOnce&quot;</span> ]</span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">managed-nfs-storage</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">10Gi</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f es-statefulset.yaml</span><br><span class="line">kubectl get po,svc -n kube-logging</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>

<h4 id="8-创建-headless-service"><a href="#8-创建-headless-service" class="headerlink" title="8.创建 headless service"></a>8.创建 headless service</h4><p>编写es-svc.yaml 文件，为 elasticsearch 的 pod 创建一个 headless service ，并在 service中声明 9200 和 9300 端口 。</p>
<p>将<code>kubectl get svc</code> 命令的返回结果提交到 答题框。【 2 分】</p>
<p><code>es-ns.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-logging</span></span><br></pre></td></tr></table></figure>

<p><code>es-svc.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">elasticsearch</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9200</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">rest</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">9300</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">inter-node</span></span><br></pre></td></tr></table></figure>

<h4 id="9-Kibana-可视化-UI-界面部署"><a href="#9-Kibana-可视化-UI-界面部署" class="headerlink" title="9.Kibana 可视化 UI 界面部署"></a>9.Kibana 可视化 UI 界面部署</h4><p>编写 kibana.yaml ，通过该文件创建 deployment 和 service ，其中 deployment 基于kibana:7.2.0 镜像创建并通过环境变量 ELASTICSEARCH_URL 指定 elasticsearch 服务地址；service 代理 kibana 的 pod 服务，并且使用 NodePort 类型。创建成功后在浏览器访问 Kibana的 UI 界面。</p>
<p>将<code>kubectl get svc</code> 命令的返回结果提交到答题框 。【 2 分】</p>
<p><code>kibana.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5601</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kibana</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">kibana</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">kibana</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kibana</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:7.2.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">1000m</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ELASTICSEARCH_URL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">http://elasticsearch:9200</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5601</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kibana.yaml</span><br><span class="line">kubectl get pod,svc -n kube-logging</span><br><span class="line">kubectl get svc</span><br></pre></td></tr></table></figure>

<h4 id="10-Fluentd-组件部署"><a href="#10-Fluentd-组件部署" class="headerlink" title="10.Fluentd 组件部署"></a>10.Fluentd 组件部署</h4><p>编写 fluentd.yaml ，通过 yaml 文件创建 DaemonSet 控制器部署 fluentd 服务，并在该文件中同时编写相关的 sa 账号和 rbac 内容，创建成功后保证可以正确采集容器内的日志。</p>
<p>将 <code>kubectl get pods</code> 命令的返回结果 提交到答题框。【 2 分】</p>
<p><code>fluentd.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">fluentd</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">fluentd</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-logging</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">fluentd</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">fluentd</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">fluentd</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">fluentd</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">fluentd</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fluentd</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">fluent/fluentd-kubernetes-daemonset:v1.4.2-debian-elasticsearch-1.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">FLUENT_ELASTICSEARCH_HOST</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;elasticsearch.kube-logging.svc.cluster.local&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span>  <span class="string">FLUENT_ELASTICSEARCH_PORT</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;9200&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FLUENT_ELASTICSEARCH_SCHEME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">&quot;http&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FLUENTD_SYSTEMD_CONF</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">disable</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">512Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/log</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/log</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/lib/docker/containers</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f fluentd.yaml</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>

<h2 id="C模块题目：企业级应用的自动化部署和运维"><a href="#C模块题目：企业级应用的自动化部署和运维" class="headerlink" title="C模块题目：企业级应用的自动化部署和运维"></a>C模块题目：企业级应用的自动化部署和运维</h2><p>虚拟机与环境规划</p>
<table>
<thead>
<tr>
<th align="center">设备名称</th>
<th align="center">主机名</th>
<th align="center">接口</th>
<th align="center">IP 地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">云服务器1</td>
<td align="center">ansible</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.150.&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器2</td>
<td align="center">host1</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.160.&#x2F;24</td>
</tr>
<tr>
<td align="center">云服务器3</td>
<td align="center">host2</td>
<td align="center">eth0</td>
<td align="center">私网IP: 192.168.100.170.&#x2F;24</td>
</tr>
</tbody></table>
<h3 id="任务1-企业级应用的自动化部署（-10-分）"><a href="#任务1-企业级应用的自动化部署（-10-分）" class="headerlink" title="任务1 企业级应用的自动化部署（ 10 分）"></a>任务1 企业级应用的自动化部署（ 10 分）</h3><h4 id="1-部署主从数据库"><a href="#1-部署主从数据库" class="headerlink" title="1.部署主从数据库"></a>1.部署主从数据库</h4><p>（1）修改主机名 ansible 节点主机名为 ansible,host1 节点主机名为 host1,host2 节点主机名为 host2, 请使用提供的软件包在 ansible 节点安装 ansible 。</p>
<p>将 <code>ansible --version</code> 命令 的返回结果提交到答题框 。【 1 分】</p>
<p><strong>ansible</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname --static ansible </span><br><span class="line">yum install -y epel-release</span><br><span class="line">yum install -y ansible</span><br><span class="line">ansible --version</span><br></pre></td></tr></table></figure>

<p><strong>host</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname --static host1</span><br><span class="line">hostnamectl set-hostname --static host2</span><br></pre></td></tr></table></figure>

<p><strong>ALL</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld --now</span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.100.150 ansible</span></span><br><span class="line"><span class="string">192.168.100.160 host1</span></span><br><span class="line"><span class="string">192.168.100.170 host2</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>（2）配置主机清单文件，创建 mysql 主机组， mysql 主机组内添加 host1 和 host2 主机，创建 mysql1 主机组 mysql1 组内添加 host1 主机，创建 mysql2 主机组 mysql2 组内添加 host2主机，并配置免密登录。</p>
<p>将 <code>ansible all -m &quot;ping&quot;</code> 命令的返回结果 提交到答题框。【 1 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id root@host1</span><br><span class="line">ssh-copy-id root@host2</span><br><span class="line"><span class="built_in">mkdir</span> ansible</span><br><span class="line"><span class="built_in">cd</span> ansible/</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line">ansible all -m <span class="string">&quot;ping&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>ansible.cfg</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[defaults]</span></span><br><span class="line"><span class="attr">inventory</span> = ./inventory</span><br><span class="line"><span class="attr">remote_user</span> = root</span><br><span class="line"><span class="attr">ask_pass</span> = <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><code>inventory</code> </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line">host1</span><br><span class="line">host2</span><br><span class="line"><span class="section">[mysql1]</span></span><br><span class="line">host1</span><br><span class="line"><span class="section">[mysql2]</span></span><br><span class="line">host2</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m <span class="string">&quot;ping&quot;</span></span><br><span class="line">host1 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">host2 | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;ansible_facts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;discovered_interpreter_python&quot;</span>: <span class="string">&quot;/usr/bin/python&quot;</span></span><br><span class="line">    &#125;, </span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="literal">false</span>, </span><br><span class="line">    <span class="string">&quot;ping&quot;</span>: <span class="string">&quot;pong&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（3） mysql 主机组内所有主机安装 mariadb 数据库，启动数据库并设置为开机自启动。</p>
<p>在 host1 节点 将 <code>systemctl status mariadb</code> 命令的返回结果提交到答题框。【 1 分】</p>
<p><strong>ansible</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook Install.yaml</span><br></pre></td></tr></table></figure>

<p><code>Install.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;Configure mariadb&#x27;</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">svc:</span> <span class="string">mariadb</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">mariadb</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">        <span class="attr">with_items:</span> </span><br><span class="line">          <span class="bullet">-</span> <span class="string">mariadb</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">mariadb-server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">chk</span> <span class="string">service</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; svc &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><strong>host1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mariadb</span><br></pre></td></tr></table></figure>

<p>（4）编写一名称为 mariadb.sh 的 shell 脚本，该脚本具有完成 mariadb 数据库的初始化功能，要求数据库(用户名为 root, 密码为 123456)，通过 ansible 对应模块执行 mariadb.sh 完成对 mysql 主机组下的所有节点进行数据库初始化。</p>
<p>在 host1 节点，将 <code>mysql -uroot -p123456</code> 命令的返回结果提交到答题框 。【 1 分】</p>
<p><code>mariadb.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /usr/bin/expect</span></span><br><span class="line"></span><br><span class="line">spawn mysql_secure_installation</span><br><span class="line">expect <span class="string">&quot;none&quot;</span></span><br><span class="line">send <span class="string">&quot;\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;Y/n&quot;</span></span><br><span class="line">send <span class="string">&quot;y\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;password:&quot;</span></span><br><span class="line">send <span class="string">&quot;123456\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;password:&quot;</span></span><br><span class="line">send <span class="string">&quot;123456\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;Y/n&quot;</span></span><br><span class="line">send <span class="string">&quot;n\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;Y/n&quot;</span></span><br><span class="line">send <span class="string">&quot;n\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;Y/n&quot;</span></span><br><span class="line">send <span class="string">&quot;n\n&quot;</span></span><br><span class="line">expect <span class="string">&quot;Y/n&quot;</span></span><br><span class="line">send <span class="string">&quot;y\n&quot;</span></span><br><span class="line">expect off</span><br></pre></td></tr></table></figure>

<p><code>Init.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;Configure mariadb&#x27;</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">mariadb</span></span><br><span class="line">      <span class="attr">script:</span> <span class="string">mariadb.sh</span></span><br></pre></td></tr></table></figure>

<p><strong>host1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></table></figure>

<p>（5）创建主机变量，所有主机组中 host1 节点创建变量 id&#x3D;20,host2 节点创建变量 id&#x3D;30 。</p>
<p>将 <code>cat /root/ansible/inventory | grep id</code> 命令的返回结果提交到答题框。【 1 分】</p>
<p><code>Attached  /etc/ansible/hosts</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; inventory &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">host1 id=&quot;20&quot;</span></span><br><span class="line"><span class="string">host2 id=&quot;30&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /root/ansible/inventory | grep <span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<p>（6）根据 mysql 配置文件创建 mysql 的 Janja2 模板文件命名为 my.cnf.j2, 编写 mariadb.yaml 文件实现主从数据库的配置和权限设置。</p>
<p>在 ansible 节点通过 <code>cat mariadb.yaml</code> 命令查看文件内容返回结果提交到答题框， 在 host2节点进入数据库 将 <code>show slave status\G</code> 命令的返回结果提交到答题框。【 1 分】</p>
<p><code>my.cnf.j2</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line">symbolic-links=0skip-grant-tables</span><br><span class="line">server_id=&#123;&#123; id &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;% if ansible_ens32.ipv4.address == master_host %&#125;</span><br><span class="line">log-bin= ON</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">pid-file=/var/run/mariadb/mariadb.pid</span><br></pre></td></tr></table></figure>

<p><code>mariadb.yaml</code> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;Setup mariadb&#x27;</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">vars:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">login_user:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">login_passwd:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">master_host:</span> <span class="string">&quot;192.168.100.160&quot;</span></span><br><span class="line">      <span class="attr">slave:</span> <span class="string">&quot;192.168.100.170&quot;</span></span><br><span class="line">      <span class="attr">mysql_path:</span> <span class="string">/usr/local/mysql/bin/</span></span><br><span class="line">      <span class="attr">basedir_name:</span> <span class="string">/usr/bin/</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deploy</span> <span class="string">template</span></span><br><span class="line">      <span class="attr">template:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">my.cnf.j2</span> </span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/my.cnf</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">user</span> <span class="string">root</span>   </span><br><span class="line">      <span class="attr">shell:</span> <span class="string">chdir=&#123;&#123;</span> <span class="string">basedir_name</span> <span class="string">&#125;&#125;</span> <span class="string">./mysql</span>   <span class="string">-u&#123;&#123;</span> <span class="string">login_user</span> <span class="string">&#125;&#125;</span> <span class="string">-p&#123;&#123;</span> <span class="string">login_passwd</span> <span class="string">&#125;&#125;</span> <span class="string">-e</span> <span class="string">&#x27;grant all privileges on *.* to &quot;root&quot;@&quot;%&quot; identified by &quot;123456&quot;&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">user</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">chdir=&#123;&#123;</span> <span class="string">basedir_name</span> <span class="string">&#125;&#125;</span> <span class="string">./mysql</span>   <span class="string">-u&#123;&#123;</span> <span class="string">login_user</span> <span class="string">&#125;&#125;</span> <span class="string">-p&#123;&#123;</span> <span class="string">login_passwd</span> <span class="string">&#125;&#125;</span> <span class="string">-e</span> <span class="string">&#x27;grant replication slave on *.* to &quot;user&quot;@&quot;%&quot; identified by &quot;123456&quot;&#x27;</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">flush_privileges</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">restart</span> <span class="string">db_svc</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_ens32.ipv4.address</span>  <span class="string">==</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; master_host &#125;&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Slave</span> <span class="string">mariadb</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">chdir=&#123;&#123;</span> <span class="string">basedir_name</span> <span class="string">&#125;&#125;</span> <span class="string">./mysql</span>   <span class="string">-u&#123;&#123;</span> <span class="string">login_user</span> <span class="string">&#125;&#125;</span> <span class="string">-p&#123;&#123;</span> <span class="string">login_passwd</span> <span class="string">&#125;&#125;</span> <span class="string">-e</span> <span class="string">&#x27;change master to master_host=&quot;host1&quot;,master_user=&quot;user&quot;,master_password=&quot;123456&quot;&#x27;</span></span><br><span class="line">      <span class="attr">when:</span> <span class="string">ansible_ens32.ipv4.address</span>  <span class="string">==</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; slave &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">flush_privileges</span></span><br><span class="line">         <span class="bullet">-</span> <span class="string">restart</span> <span class="string">db_svc</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">db_svc</span></span><br><span class="line">      <span class="attr">service:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">mariadb</span> </span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flush_privileges</span></span><br><span class="line">      <span class="attr">shell:</span>  <span class="string">chdir=&#123;&#123;</span> <span class="string">basedir_name</span> <span class="string">&#125;&#125;</span> <span class="string">./mysql</span>  <span class="string">-u&#123;&#123;</span> <span class="string">login_user</span> <span class="string">&#125;&#125;</span> <span class="string">-p&#123;&#123;</span> <span class="string">login_passwd</span> <span class="string">&#125;&#125;</span> <span class="string">-e</span> <span class="string">&quot;flush privileges&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ansible</span></span><br><span class="line">ansible-playbook mariadb.yaml</span><br><span class="line"><span class="comment"># &gt;&gt;&gt; host2</span></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line">start slave;</span><br><span class="line">show slave status\G;</span><br><span class="line"><span class="comment"># Slave_IO_Running 和 Slave_SQL_Running的状态都为 YES，则从节点服务开启成功</span></span><br></pre></td></tr></table></figure>

<h4 id="2-部署-zookeeper-集群"><a href="#2-部署-zookeeper-集群" class="headerlink" title="2.部署 zookeeper 集群"></a>2.部署 zookeeper 集群</h4><p>zookeeper 是一个分布式服务框架，是 Apache Hadoop 的一个子项目，主要是用来解决分布式应用中经常遇到的一些数据管理问题，如：统一命名服务、状态同步服务、集群管理、分布式应用配置项的管理等。 gpmall 商城系统中用到了 kafka 消息队列， kafka 集群的搭建依赖 zookeeper 集群来进行元数据的管理。</p>
<p>（1）编写主机清单文件，创建 zookeeper 主机组， zookeeper 主机组内添加 ansible 、 host1和 host2 主机 ，分别创建主机变量 zk_id。</p>
<p>将 <code>ansible all -a &quot;id&quot;</code> 命令的返回结果提交到答题框。【 2 分】</p>
<p><code>Attached inventory</code> </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[zookeeper]</span></span><br><span class="line">ansible <span class="attr">zk_id</span>=<span class="number">150</span></span><br><span class="line">host1 <span class="attr">zk_id</span>=<span class="number">160</span></span><br><span class="line">host2 <span class="attr">zk_id</span>=<span class="number">170</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible all -a <span class="string">&quot;id&quot;</span></span><br></pre></td></tr></table></figure>

<p>（2）在 ansible 节点， 使用提供的 zookeeper-3.4.14.tar.gz 软件包， 编写 zookeeper.yaml 文件实现 zookeeper 集群搭建，创建任务清单实现 zookeeper 安装包批量解压、通过 Janja2 模板文件配置 zookeeper 、创建 zookeeper 的 myid 文件和批量启动 zookeeper 功能。 </p>
<p>在三个节点相应的目录使用 <code>./zkServer.sh status</code> 命令查看三个 Zookeeper 节点的状态。</p>
<p>在 ansible 主机上将 <code>cat zookeeper.yaml</code> 命令结果提交到答题框， 将 jps 命令的返回结果提交到答题框 。【 2 分】</p>
<p><code>zoo.cfg.j2</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=&#123;&#123; zookeeper_data_dir &#125;&#125;</span><br><span class="line">dataLogDir=&#123;&#123; zookeeper_log_dir &#125;&#125;</span><br><span class="line">clientPort=2181</span><br><span class="line">maxClientCnxns=60</span><br><span class="line">server.150=192.168.100.150:2888:3888</span><br><span class="line">server.160=192.168.100.160:2888:3888</span><br><span class="line">server.170=192.168.100.170:2888:3888</span><br></pre></td></tr></table></figure>

<p> <code>zookeeper.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;Setup mariadb&#x27;</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">zookeeper</span></span><br><span class="line">  <span class="attr">vars:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">zookeeper_version:</span> <span class="string">zookeeper-3.4.14</span></span><br><span class="line">      <span class="attr">zookeeper_data_dir:</span> <span class="string">/data/zookeeper/data</span></span><br><span class="line">      <span class="attr">zookeeper_log_dir:</span> <span class="string">/data/zookeeper/logs</span></span><br><span class="line">      <span class="attr">var_dir:</span> <span class="string">/data/zookeeper/</span></span><br><span class="line">      <span class="attr">source_dir:</span> <span class="string">/root/</span></span><br><span class="line">      <span class="attr">myid:</span> <span class="string">/data/zookeeper/data/myid</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">tasks:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deal</span> <span class="string">depends</span></span><br><span class="line">      <span class="attr">yum:</span> </span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">      <span class="attr">with_items:</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">java-1.8.0-openjdk</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">java-1.8.0-openjdk-devel</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Create</span> <span class="string">zookeeper</span> <span class="string">data</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">directory</span></span><br><span class="line">      <span class="attr">with_items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; var_dir &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; zookeeper_log_dir &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; zookeeper_data_dir &#125;&#125;</span>&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Copy</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">copy:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; zookeeper_version &#125;&#125;</span>.tar.gz&quot;</span> </span><br><span class="line">        <span class="attr">dest:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; source_dir &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">unarchive</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&quot;tar -zxvf /root/<span class="template-variable">&#123;&#123; zookeeper_version &#125;&#125;</span>.tar.gz&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&quot;mv /root/<span class="template-variable">&#123;&#123; zookeeper_version &#125;&#125;</span>/* <span class="template-variable">&#123;&#123; var_dir &#125;&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">deploy</span> <span class="string">j2</span></span><br><span class="line">      <span class="attr">template:</span> </span><br><span class="line">        <span class="attr">src:</span> <span class="string">zoo.cfg.j2</span> </span><br><span class="line">        <span class="attr">dest:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; var_dir &#125;&#125;</span>/conf/zoo.cfg&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">touch</span> <span class="string">myid</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; myid &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">write</span> <span class="string">myid</span></span><br><span class="line">      <span class="attr">lineinfile:</span> </span><br><span class="line">        <span class="attr">dest:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; myid &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">line:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; zk_id &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">zookeeper</span> <span class="string">svc</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; var_dir &#125;&#125;</span>/bin/zkServer.sh start&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook zookeeper.yaml</span><br><span class="line"><span class="comment"># &gt;&gt;&gt; all</span></span><br><span class="line"><span class="built_in">cd</span> /data/zookeeper/bin/</span><br><span class="line">./zkServer.sh status</span><br></pre></td></tr></table></figure>

<h3 id="任务-2-应用商城系统部署-【-10-分】"><a href="#任务-2-应用商城系统部署-【-10-分】" class="headerlink" title="任务 2 应用商城系统部署 【 10 分】"></a>任务 2 应用商城系统部署 【 10 分】</h3><h4 id="1-gpmall-部署"><a href="#1-gpmall-部署" class="headerlink" title="1.gpmall 部署"></a>1.gpmall 部署</h4><p>在 ansible 节点，使用提供的 gpmall-cluster 软件包，完成集群应用系统部署。部署完成后，进行登录，最后使用 curl 命令去获取商城首页的返回信息，先将 <code>netstat -ntpl</code> 命令的返回结果提交到答题框，然后 将 <code>curl -l http://EIP:80</code> 命令的返回结果提交到答题框。 【 10 分】</p>
<p><code>mycat</code> On ansible</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /opt/ChinaskillMall/Mycat-server-1.6-RELEASE-20161028204710-linux.gz /usr/local/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/</span><br><span class="line">tar -zvxf Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz</span><br><span class="line"><span class="built_in">chown</span> -R 777 /usr/local/mycat/</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">export</span> MYCAT_HOME=/usr/local/mycat/ &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">cd</span> /usr/local/mycat/conf/</span><br><span class="line"><span class="built_in">chown</span> root:root schema.xml</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line">/bin/bash /usr/local/mycat/bin/mycat start</span><br><span class="line">yum install -y MariaDB-client</span><br><span class="line">ss -ntlp |grep 8066</span><br><span class="line"></span><br><span class="line">mysql -h127.0.0.1 -P8066 -uroot -p123456</span><br><span class="line"></span><br><span class="line">show databases;</span><br><span class="line">use USERDB</span><br><span class="line">show tables;</span><br><span class="line"><span class="keyword">select</span> * from company;</span><br><span class="line">insert into company values(2,<span class="string">&quot;bastetball&quot;</span>,<span class="string">&quot;usa&quot;</span>);</span><br><span class="line"><span class="keyword">select</span> * from company;</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">ss -ntlp |grep 9066</span><br><span class="line">mysql -h127.0.0.1 -P9066 -uroot -p123456 -e <span class="string">&#x27;show @@datasource;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>Changed /usr/local/mycat/conf/schema.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;USERDB&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;test&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;3&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;hostM1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.100.160:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;hostS1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;192.168.100.170:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span>  <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Changed /usr/local/mycat/conf/server.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--在配置文件的最后部分，修改数据库为USERDB--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>USERDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--然后删除如下几行：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>user<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>TESTDB<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;readOnly&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Kafka</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># On all node</span></span><br><span class="line"><span class="built_in">mv</span> kafka_2.11-1.1.1.tgz /usr/local/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/</span><br><span class="line">tar -zxvf kafka_2.11-1.1.1.tgz</span><br><span class="line"><span class="built_in">cd</span> kafka_2.11-1.1.1/config</span><br><span class="line">sed <span class="string">&#x27;s/broker.id=0/#broker.id=0/g&#x27;</span> server.properties</span><br><span class="line">sed <span class="string">&#x27;s/zookeeper.connect=localhost:2181/#zookeeper.connect=localhost:2181/g&#x27;</span> server.properties</span><br><span class="line"><span class="comment"># On ansible</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; server.properties &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">broker.id=150</span></span><br><span class="line"><span class="string">zookeeper.connect=192.168.100.150:2181,192.168.100.160:2181,192.168.100.170:2181</span></span><br><span class="line"><span class="string">listeners = PLAINTEXT://192.168.100.150:9092</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># On host1</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; server.properties &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">broker.id=160</span></span><br><span class="line"><span class="string">zookeeper.connect=192.168.100.150:2181,192.168.100.160:2181,192.168.100.170:2181</span></span><br><span class="line"><span class="string">listeners = PLAINTEXT://192.168.100.160:9092</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># On host2</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; server.properties &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">broker.id=170</span></span><br><span class="line"><span class="string">zookeeper.connect=192.168.100.150:2181,192.168.100.160:2181,192.168.100.170:2181</span></span><br><span class="line"><span class="string">listeners = PLAINTEXT://192.168.100.170:9092</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment"># test on ansible</span></span><br><span class="line">./kafka-topics.sh --create --zookeeper 192.168.100.150:2181 --replication-factor 1 --partitions 1 --topic <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test on host1 or host2</span></span><br><span class="line">./kafka-topics.sh --list --zookeeper 192.168.100.160:2181</span><br><span class="line">./kafka-topics.sh --list --zookeeper 192.168.100.170:2181</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on ansible</span></span><br><span class="line">scp /opt/ChinaskillMall/gpmall.sql root@host1:/root/</span><br><span class="line"><span class="comment"># on host1</span></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line">create database gpmall;</span><br><span class="line">use gpmall</span><br><span class="line"><span class="built_in">source</span> /root/gpmall.sql</span><br><span class="line">quit</span><br><span class="line"><span class="comment"># on ansible</span></span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line">./mycat restart</span><br></pre></td></tr></table></figure>

<p><code>Changed /usr/local/mycat/conf/schema.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mycat</span>:schema <span class="keyword">SYSTEM</span> <span class="string">&quot;schema.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mycat:schema</span> <span class="attr">xmlns:mycat</span>=<span class="string">&quot;http://io.mycat/&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">&quot;gpmall&quot;</span> <span class="attr">checkSQLschema</span>=<span class="string">&quot;false&quot;</span> <span class="attr">sqlMaxLimit</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">dataNode</span>=<span class="string">&quot;dn1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">schema</span>&gt;</span><span class="comment">&lt;!--将 schema name 修改为 gpmall--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataNode</span> <span class="attr">name</span>=<span class="string">&quot;dn1&quot;</span> <span class="attr">dataHost</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">database</span>=<span class="string">&quot;gpmall&quot;</span> /&gt;</span> <span class="comment">&lt;!--database 修改为 gpmall--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataHost</span> <span class="attr">name</span>=<span class="string">&quot;localhost1&quot;</span> <span class="attr">maxCon</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">minCon</span>=<span class="string">&quot;10&quot;</span> <span class="attr">balance</span>=<span class="string">&quot;3&quot;</span> <span class="attr">dbType</span>=<span class="string">&quot;mysql&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">dbDriver</span>=<span class="string">&quot;native&quot;</span> <span class="attr">writeType</span>=<span class="string">&quot;0&quot;</span> <span class="attr">switchType</span>=<span class="string">&quot;1&quot;</span> <span class="attr">slaveThreshold</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heartbeat</span>&gt;</span>select user()<span class="tag">&lt;/<span class="name">heartbeat</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">writeHost</span> <span class="attr">host</span>=<span class="string">&quot;hostM1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;172.16.51.22:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">readHost</span> <span class="attr">host</span>=<span class="string">&quot;hostS1&quot;</span> <span class="attr">url</span>=<span class="string">&quot;172.16.51.26:3306&quot;</span> <span class="attr">user</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">password</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">writeHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataHost</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mycat:schema</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>Changed /usr/local/mycat/conf/server.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--最后部分--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">name</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;schemas&quot;</span>&gt;</span>gpmall<span class="tag">&lt;/<span class="name">property</span>&gt;</span> <span class="comment">&lt;!--将USERDB改成gpmall--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>redis</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># on ansible</span></span><br><span class="line">yum install redis –y</span><br><span class="line">systemctl <span class="built_in">enable</span> redis --now</span><br><span class="line">scp /opt/ChinaskillMall/*.jar root@host1:/root/</span><br><span class="line">scp /opt/ChinaskillMall/*.jar root@host2:/root/</span><br><span class="line"><span class="comment"># on host1 and host2</span></span><br><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.100.150 redis.mall</span></span><br><span class="line"><span class="string">192.168.100.150 mysql.mall</span></span><br><span class="line"><span class="string">192.168.100.150 kafka1.mall</span></span><br><span class="line"><span class="string">192.168.100.160 kafka2.mall</span></span><br><span class="line"><span class="string">192.168.100.170 kafka3.mall</span></span><br><span class="line"><span class="string">192.168.100.150 zk1.mall</span></span><br><span class="line"><span class="string">192.168.100.160 zk2.mall</span></span><br><span class="line"><span class="string">192.168.100.170 zk3.mall</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> java -jar user-provider-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line"><span class="built_in">nohup</span> java -jar shopping-provider-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line"><span class="built_in">nohup</span> java -jar gpmall-shopping-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line"><span class="built_in">nohup</span> java -jar gpmall-user-0.0.1-SNAPSHOT.jar &amp;</span><br><span class="line"><span class="comment"># 查看四个后端服务是否成功启动</span></span><br><span class="line">ps -aux |grep java</span><br></pre></td></tr></table></figure>

<p><code>nginx</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br><span class="line"><span class="built_in">rm</span> -rf /usr/share/nginx/html/*</span><br><span class="line"><span class="built_in">cp</span> -rvf /opt/ChinaskillMall/dist/* /usr/share/nginx/html/</span><br><span class="line"><span class="comment"># &gt;&gt;&gt; Changed conf</span></span><br><span class="line">systemctl <span class="built_in">enable</span> nginx --now</span><br><span class="line">ss -ntlp |grep 80</span><br><span class="line">curl -L http://192.168.100.150</span><br></pre></td></tr></table></figure>

<p><code>Changed /etc/nginx/conf.d/default.conf</code></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">upstream</span> myuser &#123;          </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.160:8082</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.170:8082</span>;</span><br><span class="line">    ip_hash;               </span><br><span class="line">&#125;                         </span><br><span class="line"><span class="section">upstream</span> myshopping &#123;        </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.160:8081</span>;    </span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.170:8081</span>;  </span><br><span class="line">    ip_hash;             </span><br><span class="line">&#125;									 </span><br><span class="line"><span class="section">upstream</span> mycashier &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.160:8083</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.100.170:8083</span>; </span><br><span class="line">    ip_hash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">location</span> /user &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://myuser;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="section">location</span> /shopping &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://myshopping;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="section">location</span> /cashier &#123;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://mycashier;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="attribute">error_page</span> <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span> /50x.html;</span><br><span class="line"><span class="section">location</span> = /50x.html &#123;</span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="任务-3-Prometheus-监控-Mariadb-主从数据库【-10-分】"><a href="#任务-3-Prometheus-监控-Mariadb-主从数据库【-10-分】" class="headerlink" title="任务 3 Prometheus 监控 Mariadb 主从数据库【 10 分】"></a>任务 3 Prometheus 监控 Mariadb 主从数据库【 10 分】</h3><h4 id="1-Prometheus-及-Grafana-搭建"><a href="#1-Prometheus-及-Grafana-搭建" class="headerlink" title="1.Prometheus 及 Grafana 搭建"></a>1.Prometheus 及 Grafana 搭建</h4><p>根据 grafana-enterprise-8.3.6.linux-amd64.tar.gz 、prometheus-2.37.0.linux-amd64.tar.gz 、 node_exporter-1.3.1.linux-amd64.tar.gz 资<br>源包，安装 prometheus-2.37.0 、 node_exporter 服务并启动，安装 grafana 服务并测试浏览器登陆。</p>
<p>先将 prometheus.service 文件中的内容提交到答题框， 然后 将 <code>curl -L http://EIP:9090</code> 命令的返回结果提交到答题框。【 5 分】</p>
<p><code>prometheus.service</code></p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[unit]</span></span><br><span class="line"><span class="attr">Description</span>=prometheus</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">User</span>=root</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/prometheus-<span class="number">2.37</span>.<span class="number">0</span>.linux-amd64/prometheus --config.file=/usr/local/prometheus-<span class="number">2.37</span>.<span class="number">0</span>.linux-amd64/prometheus.yml</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=mutli-user.target</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> grafana-enterprise-8.3.6.linux-amd64.tar.gz</span><br><span class="line">tar -zxvf grafana-enterprise-8.3.6.linux-amd64.tar.gz</span><br><span class="line">yum install -y grafana-enterprise-8.3.6.rpm</span><br><span class="line"><span class="built_in">mv</span> prometheus-2.37.0.linux-amd64.tar.gz /usr/local</span><br><span class="line"><span class="built_in">mv</span> node_exporter-1.3.1.linux-amd64.tar.gz /usr/local</span><br><span class="line"><span class="built_in">cd</span> /usr/local</span><br><span class="line">tar -zxvf prometheus-2.37.0.linux-amd64.tar.gz</span><br><span class="line">tar -zxvf node_exporter-1.3.1.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> node_exporter-1.3.1.linux-amd64/</span><br><span class="line"><span class="built_in">nohup</span> node_exporter 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line"><span class="built_in">mv</span> prometheus.service /lib/systemd/system/</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> prometheus --now</span><br><span class="line"></span><br><span class="line">ss -ntlp |grep 9090</span><br><span class="line">LISTEN     0      128         :::9090                    :::*                   <span class="built_in">users</span>:((&quot;prometheus&quot;,pid=<span class="number">35383</span>,fd=<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> grafana-server --now</span><br><span class="line">curl -L http://EIP:9090</span><br></pre></td></tr></table></figure>

<h4 id="2-Prometheus-配置自定义监控项、-mysqld-exporter-安装及配置"><a href="#2-Prometheus-配置自定义监控项、-mysqld-exporter-安装及配置" class="headerlink" title="2.Prometheus 配置自定义监控项、 mysqld_exporter 安装及配置"></a>2.Prometheus 配置自定义监控项、 mysqld_exporter 安装及配置</h4><p>根据 mysqld_exporter-0.12.1.linux-amd64.tar.gz 安装 mysqld_exporter ，并创建  mysqld_exporter-0.12.1.linux-amd64&#x2F;my.cnf 文件添加被监控数据库用户名密码，修改 prometheus.yml 文件，添加两个任务： mysql-ansible-slave 、nodes ，抓取间隔都设置 5s 分别监控主从节点的 mysqld_exporter 、 node_exporter 端口，重启 prometheus 并刷新 prometheus 页面。<br>将 my.cnf 和 prometheus.yml 中的内容提交到答题框。【 5 分】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p000000</span><br><span class="line">use <span class="built_in">test</span>;</span><br><span class="line">grant replication client,process on *.* to <span class="string">&#x27;user&#x27;</span>@localhost identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">grant <span class="keyword">select</span> on *.* to mysql_monitor@localhost;</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> mysqld_exporter-0.12.1.linux-amd64.tar.gz /usr/local/</span><br><span class="line"><span class="built_in">cd</span> /usr/local/</span><br><span class="line">tar mysqld_exporter-0.12.1.linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mysqld_exporter-0.12.1.linux-amd64</span><br><span class="line"><span class="comment"># &gt;&gt;&gt;</span></span><br><span class="line">./mysqld_exporter --config.file=my.cnf</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s/scrape_interval: 15s/scrape_interval: 5s/g&#x27;</span> /usr/local/prometheus-2.37.0.linux-amd64/prometheus.yml</span><br><span class="line">systemctl restart prometheus</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="attr">user</span>=user</span><br><span class="line"><span class="attr">password</span>=<span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><code>Attached prometheus.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;mysql-ansible-slave&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;192.168.100.170:9104&#x27;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;nodes&#x27;</span></span><br><span class="line">  <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;192.168.100.160:9100&quot;</span>,<span class="string">&quot;192.168.100.170:9100&quot;</span>]     </span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">Zelas2Xerath</div><div class="post-copyright__author_desc">技术苑</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.806006.xyz/2023/04/01/Ex2/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.806006.xyz/2023/04/01/Ex2/')">一带一路暨金砖国家技能赛 - 云计算赛项样题</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.806006.xyz/2023/04/01/Ex2/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=一带一路暨金砖国家技能赛 - 云计算赛项样题&amp;url=https://blog.806006.xyz/2023/04/01/Ex2/&amp;pic=https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.806006.xyz" target="_blank">HugeH4rD</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/ChinaSkills/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ChinaSkills<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>云计算<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E9%87%91%E7%A0%96/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>金砖<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E6%A0%B7%E9%A2%98/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>样题<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>职业技能大赛<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2023/03/31/AWX/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/10/DOXhRetckmozqyF.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ansible GUI 管理工具 AWX</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>猜你喜欢</span></div><div class="relatedPosts-list"><div><a href="/2023/03/01/BRICS-FS-11/" title="BRICS-FS-11_云计算赛项样题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/15/FCSyTrh1zm9JoUN.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-03-01</div><div class="title">BRICS-FS-11_云计算赛项样题</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar" title="点击展开"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这有关于<b style="color:#fff">运维、开发、后端</b>相关的问题和看法。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Zelas2Xerath</h1><div class="author-info__desc">技术苑</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/zelas2xerath" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/324690213" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">2023/8/24-跟进上游更新 Bug fix </div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://npm.elemecdn.com/hexo-lib@1.0.22/img/face.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://npm.elemecdn.com/hexo-lib@1.0.22/img/back.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E5%B8%A6%E4%B8%80%E8%B7%AF%E6%9A%A8%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E6%8A%80%E8%83%BD%E8%B5%9B-%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98"><span class="toc-text">一带一路暨金砖国家技能赛 - 云计算赛项样题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A%E6%A8%A1%E5%9D%97%E9%A2%98%E7%9B%AE%EF%BC%9AOpenStack-%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-text">A模块题目：OpenStack 平台部署与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-%E7%A7%81%E6%9C%89%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88-6-%E5%88%86%EF%BC%89"><span class="toc-text">任务1 私有云平台环境初始化（ 6 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-text">1.配置主机名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-hosts-%E6%96%87%E4%BB%B6"><span class="toc-text">2.配置 hosts 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%8C%82%E8%BD%BD%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F"><span class="toc-text">3.挂载光盘镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E9%85%8D%E7%BD%AE-controller-%E8%8A%82%E7%82%B9-yum-%E6%BA%90"><span class="toc-text">4.配置 controller 节点 yum 源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%90%AD%E5%BB%BA-ftp-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">5.搭建 ftp 服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE-compute-%E8%8A%82%E7%82%B9-yum-%E6%BA%90"><span class="toc-text">6.配置 compute 节点 yum 源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%88%86%E5%8C%BA"><span class="toc-text">7.分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98-%E8%84%8F%E6%95%B0%E6%8D%AE%E5%9B%9E%E5%86%99"><span class="toc-text">8.系统调优 脏数据回写</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-OpenStack-%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1-8-%E5%88%86"><span class="toc-text">任务 2 OpenStack 搭建任务 8 分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="toc-text">1.修改脚本文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="toc-text">2.修改脚本文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85openstack%E5%8C%85"><span class="toc-text">3.安装openstack包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6"><span class="toc-text">4.搭建数据库组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%90%AD%E5%BB%BA%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-text">5.搭建认证服务组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%90%AD%E5%BB%BA%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-text">6.搭建镜像服务组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%90%AD%E5%BB%BA%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-text">7.搭建计算服务组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BD%91%E7%BB%9C"><span class="toc-text">8.搭建网络组件并初始化网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E6%90%AD%E5%BB%BA%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2"><span class="toc-text">9.搭建形化界面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-OpenStack-%E8%BF%90%E7%BB%B4%E4%BB%BB%E5%8A%A1%EF%BC%88-13-%E5%88%86%EF%BC%89"><span class="toc-text">任务 3 OpenStack 运维任务（ 13 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E5%85%A8%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-text">1.安全组管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"><span class="toc-text">2.项目管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">3.用户管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86"><span class="toc-text">4.镜像管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-text">5.后端配置文件管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">6.存储服务管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-text">7.数据库管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-text">8.数据库管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="toc-text">9.存储管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="toc-text">10.存储管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="toc-text">11.存储管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86"><span class="toc-text">12.存储管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-%E6%B7%BB%E5%8A%A0%E6%8E%A7%E5%88%B6%E8%8A%82%E7%82%B9%E8%B5%84%E6%BA%90%E5%88%B0%E4%BA%91%E5%B9%B3%E5%8F%B0"><span class="toc-text">13.添加控制节点资源到云平台</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E5%9B%9B-OpenStack-%E6%9E%B6%E6%9E%84-%E4%BB%BB%E5%8A%A1-3-%E5%88%86"><span class="toc-text">任务四 OpenStack 架构 任务 3 分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%B5%AE%E5%8A%A8IP"><span class="toc-text">1.创建浮动IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4%E6%B5%AE%E5%8A%A8IP"><span class="toc-text">2.删除浮动IP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B%E6%A8%A1%E5%9D%97%E9%A2%98%E7%9B%AE%EF%BC%9A%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BC%96%E6%8E%92%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-text">B模块题目：容器的编排与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%88-10-%E5%88%86%EF%BC%89"><span class="toc-text">任务 1 容器云平台环境初始化（ 10 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">1.容器云平台的初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Yum-%E6%BA%90%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%8C%82%E8%BD%BD"><span class="toc-text">2.Yum 源数据的持久化挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Yum-%E6%BA%90%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-text">3.Yum 源的编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Yum-%E6%BA%90%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-text">4.Yum 源的编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Yum-%E6%BA%90%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-text">5.Yum 源的编写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%AE%BE%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.设时间同步服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%AE%BE%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-text">7.设置免密登录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-k8s-%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1-15-%E5%88%86"><span class="toc-text">任务 2 k8s 搭建任务 15 分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85-docker-%E5%BA%94%E7%94%A8"><span class="toc-text">1.安装 docker 应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85-docker-%E5%BA%94%E7%94%A8"><span class="toc-text">2.安装 docker 应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85-docker-compose"><span class="toc-text">3.安装 docker compose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BA-horbor-%E4%BB%93%E5%BA%93"><span class="toc-text">4.搭建 horbor 仓库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E4%B8%8A%E4%BC%A0-docker-%E9%95%9C%E5%83%8F"><span class="toc-text">5.上传 docker 镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%AE%89%E8%A3%85-kubeadm-%E5%B7%A5%E5%85%B7"><span class="toc-text">6.安装 kubeadm 工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%88%9D%E5%A7%8B%E5%8C%96-master-%E8%8A%82%E7%82%B9"><span class="toc-text">7.初始化 master 节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9"><span class="toc-text">8.删除污点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%AE%89%E8%A3%85-kubernetes-%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="toc-text">9.安装 kubernetes 网络插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E7%BB%99-kubernetes-%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6"><span class="toc-text">10.给 kubernetes 创建证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-kubernetes-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">11.kubernetes 图形化界面的安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-%E6%89%A9%E5%B1%95%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-text">12.扩展计算节点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-EFK-%E6%97%A5%E5%BF%97%E5%B9%B3%E5%8F%B0%E6%9E%84%E5%BB%BA-15-%E5%88%86"><span class="toc-text">任务 3 EFK 日志平台构建 15 分</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-text">1.导入镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-NFS-%E9%85%8D%E7%BD%AE"><span class="toc-text">2.NFS 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-RBAC-%E9%85%8D%E7%BD%AE"><span class="toc-text">3.RBAC 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-RBAC-%E9%85%8D%E7%BD%AE"><span class="toc-text">4.RBAC 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-StorageClass%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A"><span class="toc-text">5.StorageClass动态绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-StorageClass%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A"><span class="toc-text">6.StorageClass动态绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E9%80%9A%E8%BF%87-statefulset-%E5%88%9B%E5%BB%BA-elasticsearch-%E9%9B%86%E7%BE%A4"><span class="toc-text">7.通过 statefulset 创建 elasticsearch 集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E5%88%9B%E5%BB%BA-headless-service"><span class="toc-text">8.创建 headless service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-Kibana-%E5%8F%AF%E8%A7%86%E5%8C%96-UI-%E7%95%8C%E9%9D%A2%E9%83%A8%E7%BD%B2"><span class="toc-text">9.Kibana 可视化 UI 界面部署</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-Fluentd-%E7%BB%84%E4%BB%B6%E9%83%A8%E7%BD%B2"><span class="toc-text">10.Fluentd 组件部署</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C%E6%A8%A1%E5%9D%97%E9%A2%98%E7%9B%AE%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="toc-text">C模块题目：企业级应用的自动化部署和运维</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A11-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%EF%BC%88-10-%E5%88%86%EF%BC%89"><span class="toc-text">任务1 企业级应用的自动化部署（ 10 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%83%A8%E7%BD%B2%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">1.部署主从数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%83%A8%E7%BD%B2-zookeeper-%E9%9B%86%E7%BE%A4"><span class="toc-text">2.部署 zookeeper 集群</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-%E5%BA%94%E7%94%A8%E5%95%86%E5%9F%8E%E7%B3%BB%E7%BB%9F%E9%83%A8%E7%BD%B2-%E3%80%90-10-%E5%88%86%E3%80%91"><span class="toc-text">任务 2 应用商城系统部署 【 10 分】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-gpmall-%E9%83%A8%E7%BD%B2"><span class="toc-text">1.gpmall 部署</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-Prometheus-%E7%9B%91%E6%8E%A7-Mariadb-%E4%B8%BB%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%90-10-%E5%88%86%E3%80%91"><span class="toc-text">任务 3 Prometheus 监控 Mariadb 主从数据库【 10 分】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Prometheus-%E5%8F%8A-Grafana-%E6%90%AD%E5%BB%BA"><span class="toc-text">1.Prometheus 及 Grafana 搭建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Prometheus-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E6%8E%A7%E9%A1%B9%E3%80%81-mysqld-exporter-%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AE"><span class="toc-text">2.Prometheus 配置自定义监控项、 mysqld_exporter 安装及配置</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/01/Ex2/" title="一带一路暨金砖国家技能赛 - 云计算赛项样题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/18/HxoXm2wUsZBnubR.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一带一路暨金砖国家技能赛 - 云计算赛项样题"/></a><div class="content"><a class="title" href="/2023/04/01/Ex2/" title="一带一路暨金砖国家技能赛 - 云计算赛项样题">一带一路暨金砖国家技能赛 - 云计算赛项样题</a><time datetime="2023-04-01T14:00:00.000Z" title="发表于 2023-04-01 22:00:00">2023-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/31/AWX/" title="Ansible GUI 管理工具 AWX"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/10/DOXhRetckmozqyF.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ansible GUI 管理工具 AWX"/></a><div class="content"><a class="title" href="/2023/03/31/AWX/" title="Ansible GUI 管理工具 AWX">Ansible GUI 管理工具 AWX</a><time datetime="2023-03-31T14:00:00.000Z" title="发表于 2023-03-31 22:00:00">2023-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/03/01/BRICS-FS-11/" title="BRICS-FS-11_云计算赛项样题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/15/FCSyTrh1zm9JoUN.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BRICS-FS-11_云计算赛项样题"/></a><div class="content"><a class="title" href="/2023/03/01/BRICS-FS-11/" title="BRICS-FS-11_云计算赛项样题">BRICS-FS-11_云计算赛项样题</a><time datetime="2023-03-01T14:00:00.000Z" title="发表于 2023-03-01 22:00:00">2023-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/DIY230227/" title="[23年3月抢先版] DIYer‘s Home 冲击最佳装机月"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/10/tXpAnWv1zHBfYMI.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[23年3月抢先版] DIYer‘s Home 冲击最佳装机月"/></a><div class="content"><a class="title" href="/2023/02/27/DIY230227/" title="[23年3月抢先版] DIYer‘s Home 冲击最佳装机月">[23年3月抢先版] DIYer‘s Home 冲击最佳装机月</a><time datetime="2023-02-27T01:00:00.000Z" title="发表于 2023-02-27 09:00:00">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/02/python-man/" title="手动编译安装 python"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://s2.loli.net/2022/06/13/qLBwxPklc5oX42D.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="手动编译安装 python"/></a><div class="content"><a class="title" href="/2023/02/02/python-man/" title="手动编译安装 python">手动编译安装 python</a><time datetime="2023-02-02T14:00:00.000Z" title="发表于 2023-02-02 22:00:00">2023-02-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:leancode@189.cn" title="email"><i class="anzhiyufont anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://weibo.com/leancode" title="微博"><i class="anzhiyufont anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=100078912407411" title="facebook"><i class="anzhiyufont anzhiyufont anzhiyu-icon-facebook1"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com/zelas2xerath" title="Github"><i class="anzhiyufont anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://space.bilibili.com/324690213" title="Bilibili"><i class="anzhiyufont anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener" href="https://v.douyin.com/ipyraW4/" title="抖音"><i class="anzhiyufont anzhiyufont anzhiyu-icon-tiktok"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="网盘" target="_blank" rel="noopener" href="https://pan.806006.xyz/">网盘</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">板块</div><div class="footer-links"><a class="footer-item" title="OpenWrt" href="/Openwrt/">OpenWrt</a><a class="footer-item" title="PWN" href="/Pwn/">PWN</a><a class="footer-item" title="逆向" href="/Reverse/">逆向</a><a class="footer-item" title="网络" href="/Net/">网络</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a><a class="footer-item" title="好物清单" href="/equipment/">好物清单</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/bottom.svg" alt="距离上市也就还差一个小目标~" title="距离上市也就还差一个小目标~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo" title="博客框架为Hexo"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/Hexo.svg" alt="博客框架为Hexo"/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题 Anzhiyu" title="主题 Anzhiyu"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/Theme.svg" alt="主题 Anzhiyu"/></a><a class="github-badge" target="_blank" href="https://sm.ms/" style="margin-inline:5px" data-title="本站图床由 SM.MS 提供" title="本站图床由 SM.MS 提供"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/DrawingBed.svg" alt="本站图床由 SM.MS 提供"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px" data-title="本站由 Serverless Framework 构建" title="本站由 Serverless Framework 构建"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/Serverless.svg" alt="本站由 Serverless Framework 构建"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/hexo-lib@1.0.22/svg/Copyright.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2018 - 2023 By <a class="footer-bar-link" href="/" title="Zelas2Xerath" target="_blank">Zelas2Xerath</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#footer-type-tips", {
      strings: ["寒江孤影&#44;江湖故人&#44;相逢何必曾相识."],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("footer-type-tips").innerHTML = '寒江孤影&#44;江湖故人&#44;相逢何必曾相识.'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.0.15/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="浙ICP备2022018228">浙ICP备2022018228</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 板块</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/Openwrt/"><i class="fa-solid fa-wifi faa-tada"></i><span> OpenWrt</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Pwn/"><i class="fa-solid fa-0 faa-tada"></i><span> Pwn</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Reverse/"><i class="fa-brands fa-500px faa-tada"></i><span> Reverse</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Net/"><i class="fa-brands fa-battle-net faa-tada"></i><span> Net</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 好物清单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/NET/" style="font-size: 0.88rem;">.NET<sup>1</sup></a><a href="/tags/AMD/" style="font-size: 0.88rem;">AMD<sup>1</sup></a><a href="/tags/AWX/" style="font-size: 0.88rem;">AWX<sup>1</sup></a><a href="/tags/ChinaSkills/" style="font-size: 0.88rem;">ChinaSkills<sup>2</sup></a><a href="/tags/DIY/" style="font-size: 0.88rem;">DIY<sup>1</sup></a><a href="/tags/DirectX/" style="font-size: 0.88rem;">DirectX<sup>1</sup></a><a href="/tags/GPU/" style="font-size: 0.88rem;">GPU<sup>1</sup></a><a href="/tags/IDA/" style="font-size: 0.88rem;">IDA<sup>1</sup></a><a href="/tags/KVM/" style="font-size: 0.88rem;">KVM<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/Markdown/" style="font-size: 0.88rem;">Markdown<sup>1</sup></a><a href="/tags/Office/" style="font-size: 0.88rem;">Office<sup>1</sup></a><a href="/tags/Openwrt/" style="font-size: 0.88rem;">Openwrt<sup>8</sup></a><a href="/tags/Potplayer/" style="font-size: 0.88rem;">Potplayer<sup>1</sup></a><a href="/tags/Pwn/" style="font-size: 0.88rem;">Pwn<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>1</sup></a><a href="/tags/RHCE/" style="font-size: 0.88rem;">RHCE<sup>1</sup></a><a href="/tags/RHCSA/" style="font-size: 0.88rem;">RHCSA<sup>1</sup></a><a href="/tags/Redhat/" style="font-size: 0.88rem;">Redhat<sup>2</sup></a><a href="/tags/Runtimes/" style="font-size: 0.88rem;">Runtimes<sup>4</sup></a><a href="/tags/Ryzen/" style="font-size: 0.88rem;">Ryzen<sup>1</sup></a><a href="/tags/Windows/" style="font-size: 0.88rem;">Windows<sup>12</sup></a><a href="/tags/ansible/" style="font-size: 0.88rem;">ansible<sup>1</sup></a><a href="/tags/cpu/" style="font-size: 0.88rem;">cpu<sup>3</sup></a><a href="/tags/eNSP/" style="font-size: 0.88rem;">eNSP<sup>1</sup></a><a href="/tags/hexo/" style="font-size: 0.88rem;">hexo<sup>2</sup></a><a href="/tags/idm/" style="font-size: 0.88rem;">idm<sup>1</sup></a><a href="/tags/iperf/" style="font-size: 0.88rem;">iperf<sup>1</sup></a><a href="/tags/pip/" style="font-size: 0.88rem;">pip<sup>1</sup></a><a href="/tags/pwn/" style="font-size: 0.88rem;">pwn<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">云计算<sup>2</sup></a><a href="/tags/%E6%98%BE%E7%A4%BA%E5%99%A8/" style="font-size: 0.88rem;">显示器<sup>1</sup></a><a href="/tags/%E6%A0%B7%E9%A2%98/" style="font-size: 0.88rem;">样题<sup>2</sup></a><a href="/tags/%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B/" style="font-size: 0.88rem;">职业技能大赛<sup>2</sup></a><a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 0.88rem;">虚拟化<sup>1</sup></a><a href="/tags/%E8%A3%85%E6%9C%BA/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">装机<sup>3</sup></a><a href="/tags/%E8%B6%85%E9%A2%91/" style="font-size: 0.88rem;">超频<sup>2</sup></a><a href="/tags/%E9%85%8D%E7%BD%AE%E5%8D%95/" style="font-size: 0.88rem;">配置单<sup>2</sup></a><a href="/tags/%E9%87%91%E7%A0%96/" style="font-size: 0.88rem;">金砖<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/01/2018 01:23:45"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用神芯微!`,
    `寒江孤影, 相逢何必曾相识`,
    `
      ██╗   ██╗███████╗██╗  ██╗██╗███╗   ██╗██████╗  █████╗ ██████╗ 
      ╚██╗ ██╔╝██╔════╝██║ ██╔╝██║████╗  ██║██╔══██╗██╔══██╗██╔══██╗
       ╚████╔╝ █████╗  █████╔╝ ██║██╔██╗ ██║██║  ██║███████║██████╔╝
        ╚██╔╝  ██╔══╝  ██╔═██╗ ██║██║╚██╗██║██║  ██║██╔══██║██╔══██╗
         ██║   ███████╗██║  ██╗██║██║ ╚████║██████╔╝██║  ██║██║  ██║
         ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝
																																		
  
        `,
    "已上线",
    dnum,
    "天",
    "©2018 By Zelas2Xerath V1.6.1",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by Zelas2Xerath %c 你正在访问 Zelas2Xerath 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("10/01/2018 01:23:45"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "https://npm.elemecdn.com/hexo-lib@1.0.22/svg/bottom2.svg";
      img.title = "Publicing~";
      img.alt = "Publicing~";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.56.5/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://c.806006.xyz/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.17/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://c.806006.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://c.806006.xyz/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.17/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@806006.xyz";</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#blog-container","#page-header","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/js/markmap.js"></script></body></html>